Consequences of Variability in Classifier Performance Estimates
Troy Raeder , T . Ryan Hoens , Nitesh V . Chawla
Dept . of Computer Science and Engineering , University of Notre Dame
{traeder , thoens , nchawla}@csendedu
Abstract—The prevailing approach to evaluating classifiers in the machine learning community involves comparing the performance of several algorithms over a series of usually unrelated data sets . However , beyond this there are many dimensions along which methodologies vary wildly . We show that , depending on the stability and similarity of the algorithms these sometimes arbitrary methodological being compared , impact on the conclusions choices can have a significant of any study , tests . In particular , we show that performance metrics and data sets used , the type of cross validation employed , and the number of iterations of cross validation run have a significant , and often predictable , effect . Based on these results , we offer a series of recommendations for achieving consistent , reproducible results in classifier performance comparisons . including the results of statistical
I . INTRODUCTION
Reproducibility is imperative in modern science . Reproducibility not only includes the ability to recreate scientific experiments , but also the underlying data ( where possible ) . In fact , many recent data mining and machine learning conferences explicitly mention repeatability as a criterion for submission . The obvious question becomes : what is reproducibility for machine learning and data mining ? The answer is ( perhaps ) non trivial . Drummond [ 1 ] defines reproducibility broadly as the ability to reproduce in independent experimentation “ the idea that [ a ] result empirically justifies . ”
In the realm of supervised classification , this “ idea ” is often either the relative superiority of one classifier over another , or the generalized performance of a classifier . However , evaluation methodology in data mining and machine learning is far from standard . Research has produced a dizzying array of performance metrics [ 2 ] , [ 3 ] , each estimating classification performance differently . Since different metrics rank classifiers differently , the selection of an inappropriate metric can lead to incorrect conclusions about a classifier ’s suitability for a given classification task [ 4 ] .
Additionally , the manner in which training and testing examples are chosen from the set of available data is something of an open question . The most popular approach is some form of cross validation , in which the data set is partitioned into a series of disjoint folds and each fold is used to evaluate a classifier built on the rest of the data . Evaluations on individual folds are usually averaged to produce a final score .
Significant research has explored the merits of various cross validation techniques . For example , Kohavi [ 5 ] shows that ten fold cross validation has a lower variance than leaveone out cross validation or bootstrap estimation . In separate studies , Dietterich and Alpaydin [ 6 ] , [ 7 ] advocate running five separate iterations of two fold cross validation in order to reduce the correlation between the training sets , but there is no “ standard ” approach in the literature . One further aspect of evaluation that is seldom considered is that these strategies are sensitive to the order of instances within a data set . Presented with a different ordering of the same data , cross validation or hold out will choose different data for training and different data for testing , which undoubtedly yields a different evaluation of classifier performance .
This inconsistency in evaluation methodology is wellknown in the machine learning community , but what is not well studied is its impact on the reproducibility of machine learning experiments . Hanczar et al . [ 8 ] show that the variance in ROC curves computed over small data sets can significantly impact scientific conclusions . Bouckaert and Frank [ 9 ] study the consistency of statistical tests on individual data sets and recommend a corrected t test [ 10 ] across ten iterations of ten fold cross validation as the least sensitive to the order of the data . Many studies ( eg , [ 11 ] , [ 12 ] ) offer general guidelines for evaluation but do not touch on repeatability .
Contributions : We rigorously evaluate the process of evaluation , the variability therein , the impact on statistical significance of results , and its impact on the reproducibility and the generalization of scientific conclusions . We study common methodological choices in order to understand their effects on classifier performance evaluation and classifier performance comparison . We demonstrate that under the prevailing evaluation methodology ( relatively few iterations of cross validation ) , the results of classifier comparisons are overly sensitive to the ordering of the data . In fact , given two decision trees , we can produce two sets of completely opposing statistical significance results on the same group of data sets .
II . DATA AND METHODOLOGY
We consider a number of different classifiers and evaluate their performance over n ( for n ≥ 1 ) iterations of k fold cross validation ( denoted nxk fold cross validation ) on 20 different data sets . The cross validation strategies we considered include : nx10 fold , nx5 fold , and nx2 fold . While there are other validation strategies , including , but not limited to , leave one out and bootstrap , we focus on the more commonly used cross validation strategies in this paper . These strategies also allow us to evaluate the effects of different training and testing sizes , potentially resulting in pessimistic or optimistic performance estimates . In addition to crossvalidation strategies , we also employ separate testing sets when applicable . We note that over the course of many iterations ( as n → ∞ ) the average performance estimate for a given classifier may stabilize . We call this the steady state performance estimate . Conversely , estimates produced by a single iteration of 10 fold cross validation ( 1x10 fold ) , 2 iterations of 5 fold ( 2x5 fold ) , and 5 iterations of 2 fold ( 5x2 fold ) , we will call canonical estimates . The collection of estimates over each of the iterations produces an empirical distribution of performance estimates whose properties we later study .
In order to study the inherent variability in classifier performance estimates , we ran 500 iterations of 2 fold , 5fold , and 10 fold cross validation in WEKA [ 13 ] . For each iteration , the data set ordering was determined by passing a specific random number seed ( 0 through 499 ) . On each of these iterations , we evaluated six classifiers : Na¨ıve Bayes ( NB ) ( with kernel density estimation ) , Multilayer Perceptron ( MLP ) ( with 3 hidden layers ) , a 5 nearest neighbor ( 5 NN ) classifier , C4.5 [ 14 ] and Hellinger Distance decision trees ( HDDT ) [ 15 ] , and an SMO support vector machine . Unless otherwise noted , parameters not specified remained as their default in WEKA . These particular algorithms were chosen to provide a wide range of classifiers for this study . We include two different decision tree classifiers given their different levels of skew (in)sensitivity for the class distributions [ 15 ] .
Finally , we note that while there are a wide variety of performance metrics for us to choose from , in this paper we use AUROC ( Area Under the Receiver Operating Characteristic ) . This choice was influenced by its popularity as a general purpose metric , and the fact that it is less skew sensitive and makes fewer assumptions about misclassification cost than other metrics ( eg , accuracy ) [ 16 ] . These properties make it suitable to many domains which is central to the results of the paper . Note that the choice of AUROC does not alter the general observations of the paper .
III . PERFORMANCE ESTIMATES OVER VARYING
NUMBERS OF FOLDS
When performing cross validation , one is faced with an inherent trade off . If the data are divided into fewer folds , each classifier is trained on a very small number of instances , meaning that one would expect poorer performing classifiers and higher estimation variance . Dividing the data into a
Table I
RELATIVE POSITIONS ( AVERAGE RANKS ) OF AUROC ESTIMATES FROM
2 FOLD , 5 FOLD , AND 10 FOLD CROSS VALIDATION FOR DIFFERENT
CLASSIFIERS . BOLD INDICATES A STATISTICALLY SIGNIFICANT
( α = 0.05 ) DIFFERENCE FROM 2 FOLD ( CANONICAL ) OR 10 FOLD
( STEADY STATE ) ESTIMATES . CRITICAL DISTANCE FOR THE
BONFERRONI DUNN TEST IS 0709
C4.5
2.50 1.60 1.90
3.00 1.82 1.18
2 fold 5 fold 10 fold
2 fold 5 fold 10 fold
HDDT MLP Canonical 2.50 1.95 1.55
2.30 1.85 1.85
Steady State
3.00 1.90 1.10
2.70 1.88 1.43
5 NN
NB
SMO
2.85 1.73 1.43
2.95 1.90 1.05
2.65 1.95 1.40
2.90 1.95 1.15
2.60 1.65 1.75
2.85 1.70 1.45 very large number of folds greatly increases the overlap between the training sets and tends to understate the estimation variance . Kohavi [ 5 ] studied the impact of crossvalidation strategy on six UCI data sets and found that 2 fold and 5 fold cross validation tended to generate “ pessimistic ” performance estimates . However , that study compares very few data sets and only one evaluation methodology : the average of 50 runs of a particular cross validation scheme . We now explore the properties of different crossvalidation estimates in both the steady state and canonical cases . To formally investigate the relationships between performance estimates with different numbers of folds , we perform the Friedman test [ 11 ] with the Bonferroni Dunn post hoc test . The results are summarized in Table I .
Table I evaluates the extent to which a particular crossvalidation approach tends to produce optimistic or pessimistic estimates of classifier performance . Higher ranks correspond to optimistic estimates and lower ranks to pessimistic estimates . Table I provides an interesting expansion and clarification to the existing literature . We can corroborate that regardless of the classifier used or the number of iterations run , 2 fold cross validation provides relatively conservative estimates . However , beyond this , the number of iterations plays an important role .
Among canonical estimates , 10 fold and 5 fold crossvalidation are statistically indistinguishable at α = 0.05 , but 2 fold is significantly more pessimistic than 5 fold in all cases , and more pessimistic than 10 fold in half . Among steady state estimates , 2 fold and 5 fold cross validation are indistinguishable , but 10 fold cross validation is substantially more optimistic . This contradicts an earlier result by Kohavi [ 5 ] , which found 5 fold cross validation to be a pessimistic estimator . We find a significant difference for 5fold only when many iterations are averaged together . One final important observation is that none of the statements made above is universal . There are data set/classifier combinations for which 2 fold cross validation provides the most optimistic estimate even in the steady state .
IV . VARIATIONS IN PERFORMANCE ESTIMATES
The previous section was fairly restricted in that it considered only very short run canonical estimates and 500 run steady state estimates of classifier performance . The general behavior of performance estimates over an increasing series of sampling iterations is also of interest . In this section we concentrate on how each of the methods ( canonical and long term ) performs over a wide range of tests .
A . Reproducibility of results
One problem with performance estimate variability is ensuring the reproducibility of results . Diettrich [ 6 ] advocates 5x2 fold cross validation since “ Exploratory studies showed that using fewer or more than five replications increased the risk of type I error ” , but the consequences of longer run estimates are relatively unexplored . In Figure 1 we present the performance of a number of different classifiers under repeated 10 , 5 , and 2 fold cross validations . In addition to varying the cross validation scheme chosen , we also varied the classifiers and data sets . In this way we demonstrate that the results found are not specific to any combination of factors , but instead general trends common to any set of parameters chosen when evaluating classifier performance . 1 ) In each case , performance estimates stabilize after a non trivial period whose length differs for each classifier and data set .
2 ) Estimates based on few iterations can be unstable . 3 ) Conclusions drawn from the steady state estimate , in terms of absolute or relative performance of classifiers , may differ from conclusions based on canonical estimates .
In Figure 1(a ) we provide results over 500 cross validation iterations for HDDT and C4.5 in order to show that once an estimate stabilizes it generally remains stable . In Figures 1(b ) and 1(c ) , we plot only 50 and 100 iterations respectively in order to isolate specific regions of the graph . Figure 1(d ) further restricts the number of iterations observed to the first 30 iterations to demonstrate the ( potential ) for high variability under a small number of iterations . On the vote data set , performance estimates for all three classifiers shown ( C4.5 , MLP and 5 NN ) oscillate considerably before settling into their steady state rank ordering at about fifteen iterations . Importantly , all three classifiers hold the “ lead ” at some point within those first fifteen iterations . This seems to imply that any performance comparison based on so few iterations is tenuous at best .
In Figure 1(c ) , the situation is even more extreme . While the MLP separates from the pack early , C4.5 and 5 NN continue to oscillate back and forth for almost 50 iterations before finally settling into a steady state ordering . The question that naturally arises , then , is : how should these classifiers be evaluated ?
If reproducibility is ultimately the goal of an evaluation , it is worth defining precisely what is meant by reproducible results . Drummond [ 1 ] draws an interesting distinction between reproducibility and what he calls “ replicability . ” Drummond defines replicability as the ability to “ reproduce exactly ” the results of a prior experiment , meaning that every last condition of the two experiments is equivalent . Reproducibility , on the other hand , is the ability of different researchers , under different conditions , to demonstrate “ the idea that [ a ] result empirically justifies . ”
This seems like a reasonable definition of reproducibility and a laudable goal . While realizing this goal via a community effort to rerun published experiments to verify correctness seems infeasible , it is unwise to publish results supported only by a single cross validation strategy and data ordering . The practice of comparing algorithms over several data sets from diverse domains is an important step in this regard , but Table II suggests that this alone is not sufficient . An approach adopted in prior works ( eg , [ 17 ] , [ 18 ] , [ 19 ] ) is to use a paired t test across the folds of a single n by kfold cross validation run . If classifier A is significantly better across the ( usually 10 ) folds , then the difference is deemed significant and counted ; otherwise , it is ignored . Demˇsar [ 11 ] argues that such approaches decrease the reliability of subsequent statistical tests by “ drawing an arbitrary line of P < 0.05 between what counts and what doesn’t . ”
While Demˇsar raises a valid concern , we would argue that results such as the one in Figure 1(c ) show that some indicator of the significance of individual performance results is necessary to prevent the ( accidental or intentional ) reporting of unusual cases . This is especially important when comparing two classifiers which are very similar , eg , one is an adaptation of the other . To emphasize the severity of this concern , Table II illustrates the extent to which instability can affect performance results . It shows 5 fold AUROC estimates for C4.5 and HDDT , as well as the results of the Wilcoxon signed rank test of significance . In the first iteration , C4.5 performs significantly better than HDDT at α = 005 In the second , HDDT ranks higher than C4.5 and the difference is again significant at α = 005 The only difference between the two results is the random seed that was used to select the cross validation folds . A consistent random seed was used across all data sets within an iteration . One potentially attractive solution is to draw repeated cross validation samples until the variance of the resulting performance estimate is sufficiently low to provide confidence in the reported result . This is difficult in practice , however , because there is an inherent dependency among the performance estimates . It has been shown in fact [ 20 ] that it is impossible to construct an unbiased estimate for the variance of cross validation results .
Another alternative is to iterate until the performance estimates stop crossing . The challenge with this is that this point is , of course , impractical to determine with certainty as it would require vastly more computation than can be reasonably expected .
CLASSIFIER PERFORMANCE RESULTS OVER TWO SEPARATE ITERATIONS
OF 10 FOLD CROSS VALIDATION . A CONSISTENT RANDOM NUMBER
SEED WAS USED ACROSS ALL DATA SETS WITHIN AN ITERATION .
Table II
Iteration 216 C45 0.9784 0.6936 0.8996 0.8993 0.8431 0.8756 0.8646 0.9353 0.9992 0.7781 0.8654 0.8699 0.8053 0.7964 0.9354 0.8051 0.9843 0.9451 1.11
HDDT 0.9753 0.6913 0.8967 0.8877 0.8181 0.8290 0.8848 0.9301 0.9993 0.7717 0.8514 0.8533 0.7929 0.7575 0.9254 0.8023 0.9824 0.9343 1.89
Iteration 459 C45 0.9768 0.6521 0.9044 0.9021 0.8161 0.8376 0.8742 0.9247 0.9988 0.7661 0.8676 0.8669 0.8076 0.7419 0.9342 0.7722 0.9828 0.9497 1.72
HDDT 0.9820 0.6531 0.8967 0.8898 0.8333 0.8404 0.8928 0.9371 0.9991 0.7696 0.8774 0.8727 0.8127 0.7311 0.9273 0.7962 0.9835 0.9426 1.28 breast w bupa credit a crx heart c heart h horse colic ion krkp pima promoters ringnorm sonar threenorm tic tac toe twonorm vote vote1 avg . rank α = 0.10 α = 0.05
The remainder of the paper seeks to answer the following questions . First , to what extent do long run performance estimates produce reproducible results as defined above ? Second , how can we determine , in an adaptive fashion , how much iteration is sufficient ? Finally , to what extent does repeated iteration produce an authoritative answer in classifier performance comparisons .
As we have seen , by relying on canonical estimates without some assurance of significance , even well meaning researchers can arrive at vastly different conclusions . While this is true also in cases where the classifiers vary more in their inductive biases , we do not present the results here due to space constraints . This implies that in order to ensure the reproducibility of results , researchers must take care that the validation method chosen was robust against the issues we presented .
B . Bias of classifier performance estimates
In Section IV A we investigated the performance estimates of various cross validation schemes . One factor to consider when estimating the performance is the existence of a bias in the classifier on the data sets . As we shall see , this can have a profound impact on the estimated performance of a classifier . This is due to the fact that the standard approach to evaluating classifiers over several iterations of crossvalidation ( which we have used in this work and is used in all other work of which we are aware ) is to compare , in some fashion , the mean performance estimates across the several iterations . In this section we explore the consequences of this decision and the situations in which it may lead to unexpected results .
When averaging the performance of a classifier over multiple runs , the latent assumption is that the performance estimates are normally distributed . When this assumption is satisfied , the average performance can be used since it ( along with the standard deviation ) captures the overall performance of the classifiers . While this assumption is prevalent in empirical studies , it has not been appropriately validated in the literature . We now show that in some instances the normality assumption is ( obviously ) violated , and its effects on the performance estimates which can be achieved .
If class distributions are highly separable , such that many of the iterations separate the classes perfectly , then the longrun estimate will be lower than the canonical estimate with very high probability . The average of hundreds of runs is not perfect , but it is very likely that one or two randomlychosen iterations are . This idea generalizes to situations in which the classes are never perfectly separable . For a given problem , inductive bias , and performance metric there will be some maximum achievable performance . If an algorithm is especially effective ( or ineffective ) , it would approach this performance threshold most of the time and the probability of a random iteration performing better ( worse , respectively ) than the long run average is high .
Thus , the relationship between steady state and canonical performance estimates is ultimately a property of the distribution of performance estimates for a given classifier , data set , and metric . If the distribution is highly leftskewed , such that the mean is much less than the median , then long run averages will produce lower estimates . If the distribution is right skewed , steady state estimates will be higher , and under a symmetric distribution they should be roughly equivalent . Since one can imagine arbitrarily skewed estimate distributions ( and indeed the closer a classifier ’s performance is to optimal the more skewed we can expect the distribution to be ) , it may be preferable to compare the medians rather than the means of performance estimates that are based on a large number of cross validation iterations . To better explain this phenomenon , Figure 2 shows C4.5 and HDDT performance estimate distributions for four representative data sets . That is , we plot the probability of obtaining a specific AUROC value in each of these classifiers over multiple runs . In three of the four cases the distributions are left skewed , indicating that the majority of the estimates are greater than the mean . It is interesting to note that on the breast w data set , which produces a relatively symmetric distribution for all classifiers , decision trees perform poorly compared to 5 NN , and NB . In Figure 2(f ) we see that NB has an obvious left skew while MLP is normally distributed , demonstrating that the normality assumption is not only violated by decision trees , but is in fact a global phenomenon . As before , the left skewed distribution performs better than the normally distributed performance estimates
( a ) Long term performance on the twonorm data set for 500x10 fold cross validation
( b ) Long term performance on the vote data set with 50x5 fold cross validation
( c ) Long term performance on the crx data set for 100x2 fold cross validation
( d ) An enhanced view of the instability of short term performance on the crx data set for 30x2 fold cross validation
Figure 1 . Typical long run performance estimates . in the long term rankings . This implies that left skewness in the performance estimate distribution may indicate that a classifier is well suited for a problem , while symmetry may imply that a more appropriate classifier exists .
V . EVALUATING CLASSIFIERS REPRODUCIBLY
Figure 11 suggests that classifier performance estimates reach some steady state under repeated iterations of crossvalidation . This might be expected , as cross validation is a “ nearly unbiased ” estimator of prediction error [ 21 ] , meaning that it will converge to a value very close to the actual prediction error . Still , this does not necessarily mean that repeated iterations of cross validation produce a reproducible result for arbitrary performance metrics . Recall that by reproducible , we mean that different researchers following the same procedure reach the same general conclusion .
To assess the reproducibility of repeated k fold crossvalidation , we calculated a series of random n by k fold cross validation estimates and measure the similarity both in terms of the absolute performance estimate and in the relative ordering of classifiers . If the procedure is reproducible , the final estimates should be “ close ” and the ordering of the classifiers should be preserved with high probability .
Furthermore , if iterations of cross validation tend to be indistinguishable , it is natural to ask the question : How many iterations are necessary before the results are reproducible ? The answer will surely depend on the classifier
1A version of this paper with larger tables and figures is available at wwwndedu/∼dial/papers/ICDM10pdf is well known and data set under consideration since it that certain algorithms produce more stable classifiers than others [ 22 ] . Running hundreds of iterations for a classifier whose performance estimate stabilizes after ten runs is a tremendous waste of effort . It is desirable , then , to develop a criterion for stopping the iteration that allows us to avoid wasted computation . In this section , we evaluate a series of such termination criteria and show that a repeatediteration framework tends to provide reproducible results . Based on our experiments , we recommend that practitioners apply the Spearman rank correlation in order to determine convergence , as it provides good repeatability with relatively little wasted computation . it is useful
Termination Criteria : Before proposing candidate termination criteria , to outline some desirable properties of such criteria . A good criterion should be generalizable so that it can be applied to any learning problem and classifier . While any criterion will naturally depend on the performance estimates seen up to that point , we would like our criteria to be independent of the magnitude of the performance estimates themselves . This is due to the fact that , due to differences in domains , we do not know a priori whether a difference of , say , 0.001 is significant or insignificant . We would prefer for this to be determined by the criterion itself . With these considerations in mind , we propose the following criteria :
Fixed number of iterations This is the simplest possible criterion : simply run a fixed number of iterations of crossvalidation regardless of the data set and classifier .
( a ) HDDT and C4.5 on NCAAF .
( b ) HDDT and C4.5 on heart h .
( c ) HDDT and C4.5 on twonorm .
( d ) NB , HDDT , and MLP on credit a .
( e ) 5 NN , NB , and HDDT on breast w .
( f ) NB , and MLP on crx .
Figure 2 . Performance estimate distributions under AUROC ( 500x2 fold cross validation ) .
Spearman rank correlation Most classification algorithms produce , for each instance , an estimate of the probability that the instance belongs to a particular class . Different iterations of cross validation will produce different probability estimates for each instance . If a running average of the probability estimates for each instance is maintained , the rank correlation between the averages at successive iterations provides a measure of convergence for the classifier . Rank correlation measures the extent to which an arbitrary monotonic function describes the relationship between two variables ( ie , two successive iterations ) and is preferable to the more standard Pearson correlation because it does not assume a linear relationship between the variables . When the correlation exceeds a threshold t , we terminate the computation . the average probability estimates at
Kolmogorov Smirnov D statistic The KolmogorovSmirnov D statistic measures the maximum distance between two cumulative distribution functions ( CDFs ) and is used as the basis of the KS test of distributional divergence . For our purposes , it is designed to measure the convergence of our samples to the “ true ” estimate distribution . To apply the test , we split the cross validation iterations into two separate distributions , with the even iterations forming one distribution and the odd iterations forming the other . When the D statistic converges below some threshold t , meaning that the even and odd distributions are “ similar ” , we terminate the computation .
We call a termination criteria “ adaptive ” if the number of iterations of cross validation chosen varies based on some well defined function .
Determining the most appropriate criterion : In evaluating termination criteria , there are two important factors to consider . The first is the consistency of the results produced , as this is the essence of reproducibility . The second is the amount of computation required to achieve the results . If method B requires twice as long to achieve essentially the same result as method A , then method A is probably superior . We quantify reproducibility in the following manner . Using the results of our 500 cross validation runs , we apply each termination criterion 50 times to 50 random orderings of those results . We record the final performance estimate as well as the number of iterations required . We evaluate stability in the final rank orderings of classifiers through pairwise comparisons of classifiers ( ci , cj ) .
We say that a result is reproducible if the rank ordering of the classifiers is preserved with high probability . Given n performance estimates eik for classifier ci and n estimates ejk for cj , these estimates represent a completely reproducible comparison if the distribution of the eik is completely separate from the distribution of the ejk , meaning that the rank ordering of the two classifiers is perfectly consistent . The more the distributions overlap , the less consistent ( and less reproducible ) the result .
In order to quantify the separation in estimate distribu tions , we present the following simple overlap metric : n
R(i , j ) =
1 n
I(eia , eja ) . R = max(2 ∗ R(i , j ) − 1 , 2 ∗ R(j , i ) − 1 ) . a=1
( 1 )
( 2 ) where I(x , y ) is an indicator function that takes the value 1 if x > y , 1 2 if x = y , and 0 if x < y . It is clear that
A series of experimental results are presented in Table III . We provide results both for a pair of classifiers that is relatively unstable ( C4.5 and HDDT ) and a pair of classifiers that is relatively stable ( NB and SMO ) . All of the termination criteria have parameters which govern how long they will run . For the rank based criterion , we iterate until the correlation is at least 1 − 10−4 = 09999 We found that values even as high as 1 − 10−3 tend to iterate too few times , and values in the neighborhood of 1−10−5 can cause unstable classifiers such as decision trees or k nearest neighbors to iterate forever . For fixed iteration termination , we experiment with values of 10 and 50 , and for Kolmogorov Smirnov termination , we experiment with distributional separations of 0.1 and 02
As we expect , the benefits of adaptive iteration are greatest with unstable classifiers and with two fold crossvalidation ( shown in Table III(a) ) , where the variance of the performance estimate distribution is greatest . Under these circumstances , using fixed iterations provides poor performance across the board for small numbers of iterations . Note , however , that the 10 iterations shown are more than those suggested by the canonical estimates . This means that papers which use 5x2 cross validation may be difficult to reproduce if the classifiers compared are highly similar .
R(i , j ) takes on a value of 0.5 if the classifiers tie on each iteration or if one classifier “ wins ” exactly half the time . It may take on a value of 0 or 1 if one classifier is always superior , depending on which classifier wins . Because the superior classifier is irrelevant for our purposes and because we would like the metric to scale between zero and one , we apply the transformation in Equation 2 to obtain the final reproducibility metric .
When the number of fixed iterations is increased to 50 , reproducibility becomes similar to that of the adaptive methods in all cases . When the classifiers are relatively stable , however , this improved performance comes at an unnecessary computational cost ( Table III(b) ) . While the adaptive methods , KS and Rank often go far beyond 50 iterations for the unstable classifiers C4.5 and HDDT , for NB and SMO stabilization often occurs at much fewer than 50 iterations . This suggests that in such instances the canonical estimates should more accurately represent the performance of the classifiers . Due to the little overhead required to ensure reproducibility , however , we argue that these methods should nevertheless be incorporated to safeguard against false assumptions and further aid reproducibility .
For space reasons , we only included the 10 fold runs for the unstable classifiers ( Table III(c) ) . We note that each of the observations made about the 2 fold runs for the instable classifiers still hold . That is , the Fixed 10 iterations exhibit the least reproducibility , while Fixed 50 more closely follows the adaptive methods . Since each of the performance estimates is more stable than those found in the 2 fold runs , however , the effects are not as drastic .
Among the adaptive methods themselves , it appears that Rank based termination offers superior performance to KS . At t = 0.2 , KS and Rank often have similar iteration counts , and KS almost universally provides inferior reproducibility . At the stricter criterion of t = 0.1 , KS iterates significantly more but incurs only modest improvement by doing so . Due to this minor improvement coupled with the vast disparity in the number runs required , we recommend using the Rank method for determining the number of iterations that each dataset should be run under for each classifier .
VI . CASE STUDY : TRUE TEST SETS
All of the work presented thus far has focused solely on relative comparisons of cross validation methodologies . In the absence of ground truth , we have been unable to draw any absolute conclusions . In order to address this issue , we have acquired 7 data sets that have some notion of a “ true ” test set . These data sets were either provided with a test set from the original data source ( such as the KDD cup data sets KDDPE ) or are intrinsically ordered . The NCAAF , ozone , and compustat data sets , for example , are collected over time , such that one year of data can be used for testing and all prior years for training .
There is no guarantee these data sets satisfy the stationary distribution assumption , such that it is reasonable to expect cross validation performance to be predictive of test set performance . However , we feel that this situation is worth studying simply because it mimics exactly the manner in which classifiers are validated in the real world . As such , it is instructive to consider whether any over arching conclusions can be drawn in this context , especially regarding the difference between steady state and canonical estimates .
The results of our experiments appear in Tables IV and V , where “ steady state ” estimates in this case were generated with 500 iterations of cross validation . Note that regardless of the number of folds used , cross validation tends to underestimate performances . This makes intuitive sense , as crossvalidation classifiers are trained on less data than the final classifier , and is corroborated by Kohavi [ 5 ] . There are notable exceptions to this , however . On compustat for example , the performance of Na¨ıve Bayes is substantially underestimated by all three methods , yet becomes the bestperforming classifier on the true test set . This suggests that perhaps compustat , a temporal financial data set , undergoes a significant distribution shift between the training and test period . The fact that the best performing classifier ranks third on the training data underscores the need for robust analysis techniques for real world applications .
The differences between canonical and steady state estimates are also enlightening . In the ( randomly chosen ) canonical case , the most accurate ( ie , lowest MSE ) estimates for each classifier are scattered among 5 fold and 10fold runs . However , in the long run 10 fold cross validation consistently produces the best estimates . We speculate that
REPRODUCIBILITY AND STOPPING TIME ( NUMBER OF CROSS VALIDATION ITERATIONS ) FOR SEVERAL DIFFERENT TERMINATION CRITERIA . RESULTS
ARE AVERAGED ACROSS 50 RANDOM APPLICATIONS OF THE CRITERIA . COLUMNS ARE : RA N K : RANK CORRELATION AT t = 0.9999 , FI X E D T :
FIXED NUMBER OF ITERATIONS , KS T : KOLMOGOROV SMIRNOV CRITERION WITH THRESHOLD t .
Table III
( a ) Two fold cross validation : Comparing C45 and HDDT .
Reproducibility
Avg . Iterations
Fixed 10
Fixed 50
0.52 1.00 1.00 0.88 0.84 0.24 1.00 0.84 0.44 0.08 0.40 0.52 0.84 0.84 0.20 0.88 0.44 0.68 0.88
1.00 1.00 1.00 1.00 1.00 0.68 1.00 1.00 0.52 0.28 0.96 0.96 1.00 1.00 0.48 1.00 0.88 1.00 1.00
J48 Rank
HTree Rank
HTree KS 0.1
KS 0.1 1.00 1.00 1.00 1.00 1.00 0.80 1.00 1.00 0.72 0.36 1.00 1.00 1.00 1.00 0.60 1.00 0.96 1.00 1.00
Rank 0.88 1.00 1.00 1.00 1.00 0.92 1.00 1.00 0.60 0.92 0.84 1.00 1.00 1.00 0.56 0.92 1.00 0.80 1.00 ( b ) Two fold cross validation : Comparing NB and SMO .
KS 0.2 0.72 1.00 1.00 0.96 1.00 0.40 1.00 0.96 0.36 0.20 0.68 0.76 0.96 1.00 0.44 0.84 0.76 0.96 0.96
179.12 192.72 221.96 191.92 196.60 203.08 188.04 248.64 194.96 170.80 253.36 171.56 199.68 212.96 213.60 210.20 186.52 185.64 203.48
30.34 139.88 61.08 43.48 43.92 71.50 59.74 66.46 49.82 31.40 74.84 130.70 88.94 113.88 152.58 72.38 110.08 26.96 32.58
28.22 133.42 56.28 47.02 45.42 69.90 47.60 64.90 49.72 26.54 61.22 116.58 78.92 118.44 148.24 73.02 111.76 35.56 33.36
J48 KS 0.1
HTree KS 0.2
J48 KS 0.2
187.24 200.48 172.28 202.84 165.28 168.28 205.48 176.88 178.60 183.80 184.84 193.48 190.28 206.12 179.20 233.40 205.16 190.28 190.72
42.64 53.40 60.44 40.28 48.52 45.68 46.44 41.32 48.76 48.76 47.64 48.44 51.32 53.36 44.20 40.48 44.92 45.88 49.68
46.08 49.00 42.40 52.88 49.56 46.08 58.28 50.72 43.24 41.80 43.00 49.92 48.60 40.16 36.64 51.16 51.92 41.44 47.40
Reproducibility
Avg . Iterations
Fixed 10
Fixed 50
1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00
1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00
SMO KS 0.1
NB Rank
NB KS 0.1
SMO Rank
KS 0.1 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00
Rank 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 0.96 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 ( c ) Ten fold cross validation : Comparing C45 and HDDT .
KS 0.2 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00
240.92 209.56 206.56 223.52 222.88 221.08 191.88 189.44 242.16 191.68 204.76 223.36 300.68 196.28 205.40 193.80 191.16 197.36 181.32
13.20 64.92 9.12 12.64 12.94 14.90 17.10 16.00 13.54 7.52 18.40 36.10 14.38 29.20 31.80 35.24 17.02 10.44 9.80
6.00 3.08 24.80 9.20 8.82 18.30 19.36 27.42 12.74 12.02 12.50 27.94 42.58 40.62 17.46 2.00 7.30 10.26 13.36
420.92 1000.00 156.00 202.24 253.80 252.04 228.00 194.80 227.48 164.44 189.00 731.64 201.56 218.00 458.96 1000.00 246.56 210.52 191.24
NB KS 0.2
SMO KS 0.2
50.24 51.32 47.88 54.44 44.36 53.36 49.52 39.00 48.40 42.76 45.32 54.56 49.16 44.36 47.20 45.00 43.36 46.08 45.92
69.44 714.12 46.48 44.68 49.56 44.68 56.48 47.84 49.56 45.00 50.76 101.60 53.92 50.24 63.16 1000.00 51.84 49.28 51.60
Reproducibility
Fixed 10
Fixed 50
0.84 0.48 1.00 0.80 0.68 0.92 1.00 1.00 0.80 1.00 1.00 0.06 1.00 1.00 0.76 1.00 0.72 0.64 1.00
1.00 0.96 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 0.28 1.00 1.00 1.00 1.00 0.96 0.88 1.00
Rank 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 0.84 1.00 1.00 1.00 1.00 1.00 1.00 1.00
KS 0.1 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 0.68 1.00 1.00 1.00 1.00 1.00 1.00 1.00
KS 0.2 1.00 0.84 1.00 0.96 0.96 1.00 1.00 1.00 0.96 1.00 1.00 0.24 1.00 1.00 0.92 1.00 0.96 0.80 1.00
HTree Rank
143.62 92.36 51.80 30.48 30.70 51.26 47.88 39.02 62.70 86.26 58.28 75.88 69.90 62.98 114.26 63.78 87.38 74.78 76.32
J48 Rank 232.20 85.10 45.32 40.72 41.10 51.18 60.68 39.94 83.74 86.30 48.52 69.76 57.26 80.28 94.52 64.82 88.36 122.76 46.02
Avg . Iterations
HTree KS 0.1
J48 KS 0.1
HTree KS 0.2
J48 KS 0.2
222.48 219.28 225.68 193.88 175.32 187.16 193.00 204.48 175.88 190.20 201.56 224.16 185.76 221.44 205.52 223.68 254.96 245.36 205.68
205.24 200.68 185.88 200.52 194.80 210.24 215.28 219.88 202.56 173.36 198.08 200.68 219.00 255.20 205.20 237.04 195.92 240.76 177.00
54.96 47.64 47.08 47.36 44.96 39.40 40.64 54.76 42.92 37.72 40.92 45.44 52.12 58.32 45.04 50.68 54.52 52.20 48.12
50.96 47.28 49.16 59.48 53.76 42.68 47.76 40.64 39.52 37.40 52.68 43.84 49.96 46.72 48.72 55.96 56.32 48.76 42.16 dataset breast w bupa NCAAF credit a crx heart c heart h horse colic ion krkp pima promoters ringnorm sonar threenorm tic tac toe twonorm vote vote1 dataset breast w bupa NCAAF credit a crx heart c heart h horse colic ion krkp pima promoters ringnorm sonar threenorm tic tac toe twonorm vote vote1 dataset breast w bupa college football credit a crx heart c heart h horse colic ion krkp pima promoters ringnorm sonar threenorm tic tac toe twonorm vote vote1
CANONICAL CROSS VALIDATION ESTIMATES OF AUROC FROM TRUE TEST DATA SETS AND ACTUAL PERFORMANCES .
Table IV
HDDT 0.771 0.829 0.816 0.821 0.821 0.945 0.966 0.040
2 C4.5 0.769 0.837 0.777 0.798 0.808 0.941 0.969 0.045
NB 0.760 0.908 0.641 0.861 0.849 0.888 0.878 0.079
HDDT 0.794 0.837 0.841 0.841 0.812 0.957 0.968 0.031
5 C4.5 0.784 0.850 0.802 0.828 0.805 0.949 0.970 0.038
NB 0.785 0.909 0.705 0.862 0.847 0.901 0.867 0.073
HDDT 0.776 0.846 0.849 0.831 0.827 0.955 0.968 0.035
10 C4.5 0.789 0.854 0.800 0.852 0.800 0.955 0.971 0.038
NB 0.787 0.909 0.706 0.859 0.847 0.904 0.863 0.074
KDDPE college f compustat ozone 1h ozone 8h text wrds MSE
HDDT 0.813 0.842 0.832 0.934 0.879 0.958 0.993 actual C4.5 0.763 0.850 0.807 0.950 0.890 0.945 1.000
NB 0.750 0.914 0.862 0.963 0.931 0.908 0.991 this is due to the fact that 10 fold cross validation trains on the greatest amount of data and therefore is able to build the most comprehensive classifier . In the canonical case , random inconsistencies in the estimates allow 5 fold to come out ahead by chance . Steady state estimates smooth out these inconsistencies and best estimator becomes clear .
VII . DISCUSSION
One of the fundamental underpinnings of the scientific method is obtaining results which are reproducible . In the absence of reproducible results , a theory must be rejected as not having enough support . In this paper we have studied the current state of the art in comparing machine learning algorithms . We have found that while the current most popular methods for validating performance are 2x5 , 5x2 , and 1x10 fold cross validation , these “ canonical ” methods can lead to results , which a ) might not be reproducible and b ) might lead to inconsistent conclusions .
To combat these shortcomings , we recommend determining the steady state performance of the classifiers tested , and only then applying the standard statistical significance tests . In order to guide this process and aid in reproducibility , we present a series of criteria for determining an appropriate definition of “ steady state ” classifier performance . We show that a simple criterion based on the rank correlation between instances’ probability estimates over many iterations reasonably balances computation and reproducibility . Additionally , It produces substantially more repeatable results than using a small fixed number of iterations .
While studying the reproducibility of results , an important concern that arose was the “ skewness ” of the performance estimate distribution . We hypothesize that left skewed distributions indicate that the classifier is well suited to the problem , while right skewed distributions indicate a poor fit . We therefore recommend that classifiers which exhibit a left skew should be preferred for that domain .
When developing classifiers , being able to accurately estimate a candidate classifier ’s performance on future data is an important concern . In Section VI we found that long term performance estimates produced by 10 fold cross validation were most consistent with the classifiers’ measured performance on “ true ” test sets . With this in mind , we recommend using 10 fold cross validation for data sets similar to those marked “ experimental ” in this paper , ie , “ balanced ” data sets ( note : a balanced data set is one for which the number of positive and negative examples are commensurate ) .
We also noted that while cross validation results are often good predictors of future performance , there are notable exceptions when they fail to appropriately rank the classifiers . This is an important observation , as it shows that while a classifier can perform ( perhaps significantly ) better on a cross validation set , this is no guarantee that this will be realized in “ real world ” scenarios . The impacts of this will be studied more heavily in future work .
This paper focused mainly on AUROC , but the main conclusions of this work hold with other metrics . We will pursue this line of work in greater depth in the future . We will also include additional multi class and imbalanced data sets in order to paint a more comprehensive picture of how data sets , evaluation metrics , and validation strategies effect how results are drawn in the machine learning community . With this in mind , the purpose of this paper is independent of the metric used . Instead we demonstrate some of the shortcomings of current machine learning evaluation techniques , and how to mitigate them . More importantly , however , we seek to open discussion in the community on how to ensure reproducibility of results , fairness of comparisons and generalizability of experimental results .
REFERENCES
[ 1 ] C . Drummond , “ Replicability is not reproducibility : Nor is it good science , ” in Proceedings of the Evaluation Methods for Machine Learning Workshop at the 26th ICML , 2009 .
[ 2 ] R . Caruana and A . Niculescu Mizil , “ Data mining in metric space : an empirical analysis of supervised learning performance criteria , ” in Proceedings of KDD . ACM , 2004 , p . 78 .
[ 3 ] C . Ferri , J . Hern´andez Orallo , and R . Modriou , “ An empirical comparison of performance measures for classification , ” Pattern Recognition Letters , vol . 30 , pp . 27–38 , 2009 .
[ 4 ] D . J . Hand , “ Good practice in retail credit scorecard assessment , ” The Journal of the Operational Research Society , vol . 56 , no . 9 , pp . 1109–1117 , 2005 .
[ 5 ] R . Kohavi , “ A study of cross validation and bootstrap for accuracy estimation and model selection , ” in Proceedings of IJCAI , vol . 14 , 1995 , pp . 1137–1145 .
[ 6 ] T . Dietterich , “ Approximate statistical tests for comparing supervised classification learning algorithms , ” Neural computation , vol . 10 , no . 7 , pp . 1895–1923 , 1998 .
[ 7 ] E . Alpaydin , “ Combined 5 x 2 cv F test for comparing supervised classification learning algorithms , ” Neural Computation , vol . 11 , no . 8 , pp . 1885–1892 , 1999 .
[ 8 ] B . Hanczar , J . Hua , C . Sima , J . Weinstein , M . Bittner , and E . Dougherty , “ Small sample precision of ROC related estimates , ” Bioinformatics , vol . 26 , no . 6 , p . 822 , 2010 .
[ 9 ] R . Bouckaert and E . Frank , “ Evaluating the replicability of significance tests for comparing learning algorithms , ” in Proceedings of PAKDD . Springer , 2004 , pp . 3–12 .
[ 10 ] C . Nadeau and Y . Bengio , “ Inference for the generalization error , ” Machine Learning , vol . 52 , no . 3 , pp . 239–281 , 2003 .
[ 11 ] J . Demˇsar , “ Statistical comparisons of classifiers over multiple data sets , ” J . Machine Learning Research , vol . 7 , p . 30 , 2006 .
[ 12 ] S . Salzberg , “ On comparing classifiers : Pitfalls to avoid and a recommended approach , ” Data Mining and Knowledge Discovery , vol . 1 , no . 3 , pp . 317–328 , 1997 .
STEADY STATE CROSS VALIDATION ESTIMATES OF AUROC FROM TRUE TEST DATA SETS AND ACTUAL PERFORMANCES .
Table V
HDDT 0.771 0.827 0.814 0.806 0.811 0.947 0.966 0.044
2 C4.5 0.764 0.841 0.776 0.783 0.791 0.943 0.969 0.048
NB 0.763 0.908 0.663 0.859 0.848 0.889 0.878 0.077
HDDT 0.785 0.838 0.839 0.829 0.817 0.955 0.968 0.033
5 C4.5 0.781 0.849 0.807 0.826 0.800 0.949 0.971 0.038
NB 0.782 0.909 0.689 0.859 0.848 0.901 0.867 0.075
HDDT 0.791 0.840 0.847 0.840 0.816 0.957 0.969 0.032
10 C4.5 0.785 0.849 0.816 0.834 0.805 0.949 0.971 0.038
NB 0.788 0.909 0.712 0.860 0.848 0.904 0.863 0.073
KDDPE college f compustat ozone 1h ozone 8h text wrds MSE
HDDT 0.813 0.842 0.832 0.934 0.879 0.958 0.993 actual C4.5 0.763 0.850 0.807 0.950 0.890 0.945 1.000
NB 0.750 0.914 0.862 0.963 0.931 0.908 0.991
[ 13 ] G . Holmes , A . Donkin , and I . Witten , “ Weka : A machine learning workbench , ” in Second Australia and New Zealand Conference on Intelligent Information Systems , 1994 , pp . 357–361 .
[ 14 ] J . Quinlan , C4 . 5 : programs for machine learning . Morgan
Kaufmann , 1993 .
[ 15 ] D . Cieslak and N . Chawla , “ Learning decision trees for unbalanced data , ” in Proc of ECML , 2008 .
[ 16 ] F . Provost , T . Fawcett , and R . Kohavi , “ The case against accuracy estimation for comparing induction algorithms , ” in Proc of ICML , vol . 445 , 1998 .
[ 17 ] N . Lachiche and P . Flach , “ Improving accuracy and cost of two class and multi class probabilistic classifiers using ROC curves , ” in Proceedings of ICML , vol . 20 , 2003 , p . 416 .
[ 18 ] P . Melville and R . Mooney , “ Constructing diverse classifier ensembles using artificial training examples , ” in Proceedings of the IJCAI , 2003 , pp . 505–510 .
[ 19 ] G . Tsoumakas , I . Katakis , and I . Vlahavas , “ Effective voting of heterogeneous classifiers , ” Machine Learning : ECML 2004 , pp . 465–476 , 2004 .
[ 20 ] Y . Bengio and Y . Grandvalet , “ No unbiased estimator of the variance of k fold cross validation , ” The Journal of Machine Learning Research , vol . 5 , p . 1105 , 2004 .
[ 21 ] B . Efron and G . Gong , “ A leisurely look at the bootstrap , the jackknife , and cross validation , ” American Statistician , vol . 37 , no . 1 , pp . 36–48 , 1983 .
[ 22 ] L . Breiman , “ Bagging predictors , ” Machine learning , vol . 24 , no . 2 , pp . 123–140 , 1996 .
