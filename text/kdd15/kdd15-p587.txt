TOPTRAC : Topical Trajectory Pattern Mining
∗
Younghoon Kim Hanyang Univ . Ansan , Korea younghoonk79@gmail.com
Jiawei Han
UIUC
Illinois , US hanj@illinois.edu
Cangzhou Yuan∗
Beihang Univ . Beijing , China yuancz@buaaeducn
ABSTRACT With the increasing use of GPS enabled mobile phones , geotagging , which refers to adding GPS information to media such as micro blogging messages or photos , has seen a surge in popularity recently . This enables us to not only browse information based on locations , but also discover patterns in the location based behaviors of users . Many techniques have been developed to find the patterns of people ’s movements using GPS data , but latent topics in text messages posted with local contexts have not been utilized effectively .
In this paper , we present a latent topic based clustering algorithm to discover patterns in the trajectories of geo tagged text messages . We propose a novel probabilistic model to capture the semantic regions where people post messages with a coherent topic as well as the patterns of movement between the semantic regions . Based on the model , we develop an efficient inference algorithm to calculate model parameters . By exploiting the estimated model , we next devise a clustering algorithm to find the significant movement patterns that appear frequently in data . Our experiments on real life data sets show that the proposed algorithm finds diverse and interesting trajectory patterns and identifies the semantic regions in a finer granularity than the traditional geographical clustering methods .
Categories and Subject Descriptors H28 [ Database applications ] : Spatial databases and GIS
General Terms Algorithms
Keywords Topical trajectory pattern ; modeling geo tagged messages
∗This work was done when Y . Kim and C . Yuan were visiting University of Illinois at Urbana Champaign .
Figure 1 : Trajectories in New York City
1 .
INTRODUCTION
Micro blogging services such as Twitter and Tumblr have emerged recently as a medium in spotlight for communication , as we can update our status anywhere and anytime by using a mobile device . With the increasing use of GPSenabled mobile phones , user generated media with a geo tag such as text messages and photos have been produced with an accelerating trend in the micro blogging services . This enables us to not only retrieve information with locations , but also utilize the patterns of location based user behaviors . Studies on the trajectory data collected using GPS sensors have always been important topics for many location based applications such as mobile navigation system[5 ] , itinerary suggestion[19 ] , urban traffic analysis[4 ] , and tracking of hurricanes or animals[11 ] . However , these traditional trajectory mining techniques assume that the GPS sensors record the location of moving objects frequently . They also do not consider the semantic meanings of the locations which are available in the associated tags and short text messages on social media services .
Recently , trajectory mining techniques to use low sampling semantic trajectory data collected from social media services have been developed to recommend travel routes[10 ] or find interesting trajectory patterns[16 , 18 ] . However , since they assume that well refined ‘regions of interest’ and ‘semantic labels’ such as user generated categories are available , it is still hard to utilize those techniques to discover semantic trajectory patterns with respect to ‘latent topics’ of geo tagged messages posted in the local context .
587 Trajectory mining with geo tagged messages posted in social media has to deal with three difficulties : ( 1 ) how to find topically coherent regions , ( 2 ) how to handle noisy messages such as everyday conversations and ( 3 ) how to overcome the sparsity of trajectory patterns . Since geo tag is a pair of real numbers which denote latitude and longitude , we first need to cluster geo tagged messages posted at the close site with a similar topic . Let us call such regions with a coherent topic preference semantic regions . Because most of the messages posted in micro blogging services are personal and ordinary talks , it is very difficult to cluster them by the coherence of topics . Consequently , it becomes hard to identify the trajectory patterns with useful information out of noisy trajectories .
Consider the geo tagged messages posted at New York city as shown in Figure 1 . We can expect that there are popular places where messages should be posted with a coherent topic such as Time Square , Central Park and Statue of Liberty . However , even in such regions , many messages are personal without any local context such as ‘Good morning’ or ‘Happy birthday’ . Such noisy messages make it hard to identify either topical semantic regions or trajectory patterns . Furthermore , suppose many travelers move from the popular attractions such as Brooklyn Bridge to Rockfeller Building as posting geo tagged messages . However , since more people visit the neighborhood , such as Time Square , and post messages with various reasons , the topic of Rockfeller Building becomes hard to find and the pattern from Brooklyn Bridge to Rockfeller Building may also be missed . To deal with these problems , we develop a trajectory clustering algorithm , called TOPTRAC , which is TOPical TRA jeCtory pattern mining in this paper . Our algorithm is designed to discover topically coherent regions with a finer granularity by weighting the messages whose previous one also was posted in a semantic region . For example , even though the messages on Rockfeller Building are relatively sparser than those on Time Square , if there is a transition pattern of people who have arrived from another semantic region such as Brooklyn Bridge , we can identify the semantic region of Rockfeller Building . Furthermore , this also helps us discover various trajectory patterns by clustering semantic regions with a finer granularity .
To discover semantic regions with a coherent topic , Yin et al . have suggested a clustering algorithm , called LGTA , in [ 17 ] . However , since it focused on finding topically coherent locations only , it cannot cope with the other two difficulties . To the best of our knowledge , our algorithms presented here are the first work for the problem of topical trajectory pattern mining . The contributions of this paper are summarized as follows :
• We introduce a new topical clustering problem in the trajectories of geo tagged text messages .
• We propose a probabilistic model to discover not only the latent semantic regions where people post messages with a coherent topic but also the diverse patterns of movements between the semantic regions based on the observation that people may visit a place with various purposes . pute the most likely sequence of latent semantic regions for a given sequence , which works similar to the Viterbi algorithm of the hidden Markov model .
• In experiments , we show that our method finds useful semantic regions in a fine granularity as well as diverse movement patterns .
The rest of paper is structured as follows : Section 2 presents the related works of trajectory pattern mining . In Section 4.1 , we define the notations to use in this paper and introduce our generative model . We next develop a dynamic programming algorithm to identify trajectory patterns in Section 4.4 and present experimental results in Section 5 . Finally , we conclude our study in Section 6 .
2 . RELATED WORK
Trajectory mining with GPS data has been extensively studied to find patterns in the movements of objects . We first discuss about the traditional trajectory mining techniques[3 , 11 , 19 ] which utilize GPS locations only and next study the recent algorithms[7 , 10 , 16 , 17 , 18 ] that find trajectory patterns using the semantics of location .
Traditional trajectory mining algorithms usually cluster the similar transactions to find common and popular trajectories . For example , Lee et al . proposed a clustering algorithm in [ 11 ] which discovers not only the groups of similar trajectories but also the clusters with similar sub sequences . Zheng et al . introduced a ranking method in [ 19 ] based on a HIT algorithm to find popular trajectories . Furthermore , an algorithm finding the most popular path between given two locations was presented in [ 3 ] . However , these traditional trajectory mining typically have focused on the transaction data obtained from the GPS sensors which records locations very frequently , while geo tagged messages in micro blogging services are usually posted sparsely .
To discover the semantic patterns from the GPS locations tagged in pictures , the algorithm proposed in [ 10 ] finds sequential patterns of user generated tags . Since long trajectory patterns rarely exist in the trajectory of such a social media , Yin et al.[16 ] investigated the problem of finding diverse and interesting trajectory patterns . Recently , Zhang et al.[18 ] presented a clustering algorithm to find trajectory patterns that are divided delicately by utilizing the usergenerated categories of locations . However , since these techniques assume that refined tags which represent the semantic of point of interests are provided , it is hard for us to simply modify for finding topical transition patterns from the geo tagged messages .
To find topics associated with GPS locations from the geo tagged messages , Yin et al.[17 ] suggested a probabilistic model based clustering algorithm , called LGTA , that groups the geo tagged messages which have not only similar locations but also coherent topics . In [ 7 ] and [ 8 ] , extended probabilistic models of LGTA was developed to capture the patterns of individual users . Since LGTA in [ 17 ] can be simply extended for our problem of topical transition pattern mining , we compare our proposed algorithm to the extended LGTA which is presented in Appendix A .
• We develop an efficient variational EM algorithm for
3 . PRELIMINARIES posterior inference and parameter estimation .
• To find significant patterns using the estimated model , we devise a dynamic programming algorithm to com
In this section , we first provide the definitions to be used in the rest of the paper and then formulate our problem of topical trajectory pattern mining .
588 ( message , location ) s1 m1,1=(Start today ’s tour , L2 ) m1,2=(Time square , L1 ) s2 m2,1=(Apple store , L5 ) m2,2=(Running in Central park , L3 ) s3 m3,1=(Many people @ Time SQ , L1 ) m3,2=(Central park zoo , L3 ) s4 m4,1=(Liberty Statue tour , L2 ) m4,2=(I’m at Time square , L1 ) s5 m5,1=(Now , MoMA , L4 ) m5,2=(Metro . museum of art , L3 ) s6 m6,1=(At MoMA , L4 )
L3
L1
L4 m6,2=(Museum of natural history , L3 ) . . .
L2
( a ) Trajectories
( b ) A map
Figure 2 : An example of geo tagged messages
3.1 Notations for Observed Data
Here we define the notations to describe the collection of geo tagged messages posted in micro blogging services such as Twitter .
Definition 31 : A trajectory is the sequence of geotagged messages posted by a user in a given time interval such as a day or a week , where the messages are listed in the order of the posting time .
Let C={s1 , . . . , sN } be a collection of N trajectories where each trajectory is denoted by st with t=1 , . . .,N . We also let V={1 , . . . , V } be a set of word IDs in which each word appears at least once in the collection . A trajectory st=hmt,1:Nt i consists of Nt geo tagged messages where the i th message in st is represented by mt,i . We use m1:N to denote a sequence of variables mi ( i=1 , . . . , N ) .
Each geo tagged message mt,i consists of a geo tag ~Gt,i and a bag of words wt,i such that
• ~Gt,i is a 2 dimensional vector ( Gt,i,x , Gt,i,y ) represent ing the latitude and longitude respectively ,
• wt,i is a bag of words which contains Nt,i words {wt,i,1 , . . . , wt,i,Nt,i } where wt,i,j denotes the j th word in wt,i and should be one of the word IDs in the vocabulary V ( ie , wt,i,j ∈ V ) .
Furthermore , we use mt,i.timestamp to denote the time when mt,i was posted .
3.2 Problem Formulation
We first define the latent semantic region and topical tran sition pattern as follows .
Definition 32 : A latent semantic region or semantic region is a geographical location where geo tagged messages are posted with the same topic preference .
Definition 33 : A topical transition pattern or transition pattern is a movement from one semantic region to another frequently in the collection C of trajectories . Furthermore , for each transition pattern , we refer to a pair of actual geo tagged messages , which illustrate the topics of semantic regions in the transition pattern , as the transition snippets of the pattern .
We focus on the discovery of the trajectory patterns with length 2 only in our paper since longer frequent trajectory patterns rarely exist in low sampling trajectories as discussed in [ 16 ] . We now formulate the problem as follows :
Figure 3 : Graphical presentation of our model
Definition 34 : Topical trajectory mining problem : Given a collection C of geo tagged message trajectories , topical trajectory mining is to find topical transition patterns and the top k transition snippets which best represent each transition pattern .
Example 35 : Consider the six sequences of geo tagged messages in Figure 2 . Each sequence contains two messages as shown in Figure 2(a ) and the locations where the messages are posted are plotted in Figure 2(b ) . A look at the sequences s1 and s4 suggests that there is a transition pattern from ‘Statue of Liberty’ to ‘Time Square’ , whose regions are represented as L2 and L1 respectively . Furthermore , the pairs of geo tagged messages hm1,1 , m1,2i in s1 and hm4,1 , m4,2i in s4 can be regarded as the transition snippets of the pattern .
4 . FINDING TOPICAL TRAJECTORY PAT
TERNS
Our proposed algorithm is organized as follows :
( 1 ) In Section 4.1 , we first present our novel probabilistic model to describe the generative process of posting geo tagged messages in Twitter . Then , we provide an inference algorithm to learn the latent semantic regions and the transition probabilities between regions .
( 2 ) The probabilistic model enables us to identify the latent semantic regions and compute the probabilities with which a given geo tagged message is posted at those regions . Thus , in Section 4.4 , for each geo tagged message in the collected sequences , we find the most probable semantic region where each message was posted at using the calculated probabilities .
( 3 ) In the following Section 4.5 , we present an algorithm to find transition patterns that frequently occur in the collected messages as well as the method to discover the top k representative geo tagged messages which best show the frequent transition patterns .
4.1 Generative Model
In our probabilistic model , each sequence of geo tagged messages are generated independently and identically by a user . However , each geo tagged message in a sequence is produced depending on its preceding message in the sequence .
Generative process for geo tagged messages : We assume that there are M latent semantic regions and K hidden topics in the collection C of geo tagged messages . The topic distribution for a semantic region r is denoted by ~θr=hθr,1 , . . . , θr,K i , where θr,k with 1≤k≤K is the probability that the topic k is chosen to generate a text message
589 ~θr ~φk
~λt
St,i
Rt,i
Zt,i
~¯δ
~δr,k
Description Topic distribution in region r Word distribution for the kth topic Bernoulli distribution for the relationship to the local context in st Random variable representing whether mt,i is in the local context or not Random variable for the latent semantic region of mt,i Random variable that indicates the latent topic used to generate mt,i Probability distribution of selecting a starting latent semantic region Transition probability distribution from region r with topic k
~µr , Σr Mean and covariance matrix
~α,~β,~γ of r Hyper parameters the Dirichlet priors of ~θr , ~φk and ~λt respectively for
Approx . vars . q(~θr)=Dir(~ar ) q(~φk)=Dir(~bk ) q(~λt)=Beta(~ct ) q(St,i ) =hσt,i,0 , σt,i,1i q(Rt,i ) =hρt,i,1 , , ρt,i,M i q(Zt,i ) =hζt,i,1 , , ζt,i,K i
Figure 4 : The variables of our model in the sematic region r . Similarly to the LDA model[2 ] , we represent the distribution over the vocabulary V of a topic k as ~φk=hφk,1 , . . . , φk,V i , where φk,t denotes the probability that a word t is selected for the topic k .
The difference between the LDA model and our model is that we select only a topic for each text message and choose every word in the message according to the word distribution of the selected topic repeatedly . This assumption has been widely adopted in many Bayesian models for Twitter such as [ 7 , 8 ] because the length of a message is usually very short due to the 140 character limitation .
Let Rt,i and Zt,i denote the random variables of the latent semantic region and latent topic selected for the message mt,i in st respectively . For each sequence st ∈ C , we assume that there is a Bernoulli distribution ~λt which decides whether each geo tagged message in st is related to the semantic region or not ( ie , the message is posted in a local context or not . )
( 1 ) If a message mt,i does not belong to any latent semantic region ( ie , a location irrelevant message ) , the region Rt,i of mt,i is selected as any one among the M regions with probability 1/M and its geo tag is also generated with uniform probability f0 . If mt,i is posted regardless of the local context , we denote the event with the random variable St,i=0 , otherwise , St,i=1 .
( 2 ) If mt,i has a local context ( ie , St,i=1 ) , we select a latent semantic region Rt,i depending on whether its preceding message is related to a semantic region or not ( ie , St,i−1=1 or 0 ) , and if St,i−1=1 , Rt,i is chosen depending on which latent region and topic are involved to generate the previous message mt,i−1 .
In details , for case ( 2 ) , if the message mt,i is the first in the sequence ( ie , i=1 ) or the previous geo tagged message is not related to a local context ( ie , St,i−1=0 ) , we select a
For each region r=1 , . . . , M :
• Select a categorical distribution : ~θr ∼ Dir(~α )
For each topic k=1 , . . . , K :
• Select a categorical distribution : ~φk ∼ Dir(~β )
For each sequence st=hmt,1 , . . . , mt,Nt i ∈ C :
• Select a Bernoulli distribution : λt ∼ Beta(~γ ) • For each message mt,i = ( ~Gt,i , wt,i ) :
– Decide the status of mt,i : St,i ∼ Bernoulli(λt ) – If ( St,i = 0 )
◦ Select a region : Rt,i ∼ Uniform(1/M ) ◦ Generate a geo tag : ~Gt,i ∼ Uniform(f0 ) – If ( i=1∧St,1=1)∨(i≥2∧St,i−1=0∧St,i=1 ) ◦ Select a region : Rt,i ∼ Categorical(~δ0 ) ◦ Generate a geo tag : ~Gt,i ∼ N ( µRt,i , ΣRt,i )
– Else ( ie , i≥2 ∧ St,i−1 = 1 ∧ St,i =1 )
◦ Select a region : Rt,i ∼ Categorical(~δRt,i−1,Zt,i−1 ) ◦ Generate a geo tag : ~Gt,i ∼ N ( µRt,i , ΣRt,i )
– Select a topic : Zt,i ∼ Categorical(~θRt,i ) – Generate a message : wt,i ∼ Multinomial(~φZt,i )
Figure 5 : The generative process of our model region Rt,i following a categorical distribution over M latent semantic regions , denoted by ~δ0 , independently to its previous message . If its preceding message mt,i−1 is also generated in a local context ( ie , St,i−1=1 ) , Rt,i is chosen following a categorical distribution ~δRt,i−1,Zt,i−1 =hδRt,i−1,Zt,i−1,1 , . . . , δRt,i−1,Zt,i−1,M i where δRt,i−1,Zt,i−1,r denotes the transition probability with which a user submits a message in the region r after posting a message in Rt,i−1 on the topic Zt,i−1 .
With a selected region Rt,i , we choose a topic Zt,i following ~θRt,i and select every word in wt,i following ~φZt,i . Furthermore , we select a geo tag ~Gt,i ∈ R2 according to a 2 dimensional Gaussian probability function : fRt,i ( ~Gt,i ) =
1
2πq|ΣRt,i | exp−
1 2
( ~Gt,i − ~µRt,i )⊤Σ−1 Rt,i
( ~Gt,i − ~µRt,i ) ( 1 ) where ~µR and ΣR represent the mean and covariance matrix of a latent semantic region R ’s Gaussian distribution . In Figure 4 , we list the notations of posterior distributions and model parameters used in our generative model . Furthermore , we summarize the above generative process in Figure 5 and the graphical representation of our model is presented in Figure 3 .
Aims of our model : By introducing the random variable St,i to determine the relation to a local context and using a uniform distribution to generate geo tags for the messages with St,i=0 , we can identify local irrelevant messages appearing everywhere . Furthermore , the use of transition probability ~δr,k enables us to weight a semantic region which has a high conditional probability that people move into the region after visiting another semantic region .
590 4.2 Likelihood
Let Ω be the set of posterior distributions and model parameters that we have to estimate . Given Ω , let P rΩ(s ) represent the probability that a sequence s=hm1:N i of geotagged messages is generated . By introducing latent variables R1:N , S1:N and Z1:N , we can derive the probability P rΩ(s ) based on our model as follows :
P rΩ(hm1:N i )
λS1 · P r(R1|S1 ) · θR1 ,Z1 · P r(m1|R1 , Z1 )
=
·
XR1:N ,S1:N ,Z1:N Yi=2
N
λSi · P r(Ri|Si , Si−1 , Ri−1 , Zi−1 ) · θRi ,Zi · P r(mi|Ri , Zi ) where P r(mi|Ri , Zi ) represents the probability that a geotagged message mi=( ~Gi , wi ) is generated given latent semantic region Ri and topic Zi , which is
Ni
Yj=1
P r(mi|Ri , Zi ) = fRi ( ~Gi ) ·
φZi ,wj ,
( 2 ) and P r(Ri|Si , Si−1 , Ri−1 , Zi−1 ) ( or P r(Ri|Si ) with i=1 ) is the probability to select a region Ri given Si−1 , Si , Ri−1 and Zi−1 , which is formulated as
P r(Ri|Si , Si−1 , Ri−1 , Zi−1 ) =
( 3 )
1/M ¯δRi δRi−1 ,Zi−1 ,Ri if Si=0 , if ( i=1 and Si=1 ) or ( i≥2 and Si−1=0 ) , if i≥2 and Si=1 and Si−1=1 .
Then , the likelihood L can be directly formulated as
 
L =
K
Yk=1Z~φk Yt=1Z~λt t
Dir(~φk ; ~β )
M
Yr=1Z~θr
Dir(~θr ; ~α )
( 4 )
Beta(~λt ; ~γ)P rΩ(st)d~λtd~θr ~φk where Dir and Beta denote the Dirichlet and Beta distribution respectively .
4.3 Variational EM Algorithm
In order to estimate the most likely posterior distributions and model parameters with a given collection of trajectories , we utilize the variational EM algorithm[9 ] , which is one of the most popular methods for maximum likelihood estimation . To apply the variational EM algorithm , we perform the mean field approximation [ 2 ] . We summarized the approximate variables for the posterior distributions in Figure 4 . Then , we can derive a lower bound of log likelihood F by utilizing Jensen ’s inequality[15 ] . We next derive the update equations of the EM step for every model parameter and approximate variable to maximize F . Since they include long equations , we provide the lower bound F and the update equations in Appendix not to break the flow of reading .
4.4 Finding the Most Likely Sequence
To find the significant transition patterns based on the estimated model parameters , we now present a dynamic programming algorithm which computes the most likely sequence of latent semantic regions for a given trajectory . This is similar to the Viterbi algorithm for the HMM model[12 ] , which finds the most likely sequence of hidden states that results in the sequence of observed events .
Dynamic programming : Given a sequence st with n geotagged messages , we use the following notations in our dynamic programming formulation .
• st[i ] : the subsequence of st which starts at the first message and ends at the i th message of st .
• ¯π[i ] : the maximum probability to generate st[i ] when mt,i is submitted without any local context ( ie , St,i=0 ) .
• π[i , r , k ] : the maximum probability to create st[i ] when mt,i has the local context , its latent semantic region is r and the latent topic is k ( ie , St,i=1∧Rt,i=r∧Zt,i=k ) .
• Π[i ] : the maximum probability to generate st[i ] which is computed as max{¯π[i ] , max1≤r≤M,1≤k≤K π[i , r , k]} .
Computing ¯π[i ] and π[i , r , k ] : Let P r(mt,i|Rt,i=r , Zt,i=k ) denote the probability of posting mt,i in the latent semantic region r with topic k as defined in Equation ( 2 ) . We first consider the case when mt,i is not concerned with a local context ( ie , St,i=0 ) . Regardless of which semantic regions and topics were involved to generate its preceding message mt,i−1 , the maximum probability ¯π[i ] is simply determined by Rt,i and Zt,i both of which maximize P r(mt,i|Rt,i=r , Zt,i=k ) . Thus , ¯π[i ] is computed as
¯π[i ] = Π[i − 1 ] · max
1≤r≤M,1≤k≤K
λ0
1 M
θr,kP r(mt,i|Rt,i = r , Zt,i = k ) .
Next , suppose that mt,i is generated in a local context ( ie , St,i=1 ) . We need to consider two cases to select the most likely region Rt,i : ( 1 ) when the preceding message mt,i−1 is not related to the local context ( ie , St,i−1=0 ) and ( 2 ) when it is ( ie , St,i−1=1 ) . For case ( 1 ) , we can compute the maximum probability π[i , r , k ] to generate st[i ] regardless of Rt,i−1 and Zt,i−1 since we choose Rt,i independent to its previous message in our model . For case ( 2 ) , since Rt,i = r is selected depending on Rt,i−1 and Zt,i−1 , we compute π[i , r , k ] by enumerating the maximum probability to generate st[i ] with every pair of Rt,i−1 and Zt,i−1 . Thus , the recursive solution to compute π[i , r , k ] is
π[i , r , k ] = max 
Π[i − 1 ] · λ1 · δ0,r · θr,k · P r(mt,i|Rt,i = r , Zt,i = k ) , max1≤r′≤M,1≤k′≤K {π[i − 1 , r′ , k′ ] · λ1 · δr′ ,k′ ,r · θr,k ·P r(mt,i|Rt,i = r , Zt,i = k)}
Case ( 1 )
Case ( 2 )
 
Note that since max1≤r′≤M,1≤k′≤K { π[i − 1 , r′ , k′ ] · δr′,k′,r} for case ( 2 ) can be calculated without depending on k , we can compute the part only once for each region r and use the maximum value for every k when we compute π[i , r , k ] for every pair of r and k . We refer to this dynamic programming algorithm as TOPTRAC MLS .
Time complexity : Let n be the length of the sequence s . For each of the i th position and each region r , since it takes O(M ·K+K ) time to compute π[i , r , k ] for all k=1 , . . . , K , the time complexity of TOPTRAC MLS becomes O(n·M 2·K ) .
4.5 Finding Frequent Transition Patterns
We next find frequent transition patterns based on the most likely sequences and then , for each transition pattern , we select the top k transition snippets which best represent the pattern .
Let ¯st=h(st,1 , rt,1 , zt,1 ) , . . . , ( st,Nt , rt,Nt , zt,Nt )i denote the most likely sequence of latent variables computed by TOPTRACMLS for each sequence st in the trajectory collection C , where ( st,i , rt,i , zt,i ) represents the values of St,i , Rt,i and Zt,i respectively . We use SM L={¯s1 , . . . , ¯sT } to denote the set of the most likely sequence of every trajectory in C . We define transition pattern and transition snippet as follows :
591 ( a ) Brooklyn
( b ) Battery Park ( c ) Memorial
Sausal
( f ) Chinatown
( g ) Winery
( h ) NAIVE
Ctr . Figure 6 : Transition patterns in NYC and SANF
( d ) LGTA
( e ) ito
Definition 41 : Let st and ¯st be a trajectory and its most likely sequence respectively . Given a maximum time interval ∆ , a transition pattern h(r1 , z1 ) , ( r2 , z2)i ( r1 6= r2 ) is said to be supported by st if and only if
( 1 ) ¯st includes a subsequence h(st,i , rt,i , zt,i ) , . . . , ( st,j , rt,j , zt,j)i which starts with ( 1 , r1 , z1 ) and ends with ( 1 , r2 , z2 ) ( ie , ( st,i = 1 ∧ rt,i = r1 ∧ zt,i = z1 ) ∧ ( st,j = 1 ∧ rt,j = r2 ∧ zt,j = z2 ) )
( 2 ) si.timestamp + ∆ ≥ sj.timestamp
Furthermore , the transition snippet of the pattern is defined as the pairs of geo tagged messages hmt,i , mt,ji in st that supports the pattern .
Given SM L and the minimum support τ , we define the frequent transition pattern as a subsequence of two topical semantic regions h(r1 , z1 ) , ( r2 , z2)i which is supported by at least τ trajectories in C .
Example 42 : Suppose that we have obtained two most likely sequences from C : ¯s1=h(0 , 1 , 1 ) , ( 1 , 1 , 2 ) , ( 1 , 2 , 1)i and ¯s2=h(1 , 1 , 2 ) , ( 0 , 2 , 1 ) , ( 1 , 2 , 1)i . Assume that the time interval ∆ is 6 hours and every geo tagged message is submitted within 6 hours . Let τ = 2 . Then , h(1 , 2 ) , ( 2 , 1)i is a frequent transition pattern since both s1 and s2 support the pattern .
Among all transition snippets hmt,i , mt,ji of the frequent pattern h(r1 , z1 ) , ( r2 , z2)i appearing in any st∈C , the top k transition snippets are the k transition snippets which have the k largest probabilities of
δr1 ,z1 ,r2 P r(mt,i|Rt,i = r1 , Zt,i = z1)P r(mt,j |Rt,j = r2 , Zt,j = z2 ) , which represents the probability that a user posts the geotagged message mt,i with respect to the topic z1 in the semantic region r1 and next transports himself to r2 where he submits mt,j with topic z2 .
5 . EXPERIMENTS
We empirically evaluated the performance of our proposed algorithms . All experiments reported in this section were performed on the machines with Intel(R ) Core(TM)2 Duo CPU 2.66GHz and 8GB of main memory . All algorithms were implemented using Javac Compiler of version 17 For our experiments , we implemented the following algorithms .
• TOPTRAC : This is the implementation of our trajectory pattern mining algorithm proposed in this paper .
• LGTA : It denotes the extended LGTA algorithm[17 ] to find trajectory patterns . In this algorithm , we first run the inference algorithm in [ 17 ] and find frequent trajectory patterns similar to our algorithm in Section 44 We present the details of the algorithm in Appendix A . y t i s r a p s l a i t a p S y t i s r a p s l a i t a p S
0.08
0.07
0.06
0.05
0.04
0.03
0.02
0.01
0
0
0.1
0.08
0.06
0.04
0.02
0
0
TOPTRAC LGTA NAIVE
0.1
0.2
0.3
0.4
0.5
Topical coherence
( a ) NYC data set
TOPTRAC LGTA NAIVE
0.1
0.2
0.3
0.4
0.5
Topical coherence
( b ) SAF data set
Figure 8 : Distributions of transition patterns
• NAIVE : We implemented a naive trajectory pattern mining algorithm which first groups messages geographically by GPS locations using EM clustering[1 ] and then clusters the messages topically in each group with LDA[2 ] . In each geographical cluster r , we select the most likely latent topic for a message mt,i by using Nt,i j=1 φk,wt,i,j where θr,k and φk,w arg maxk=1,,K θr,k Q are the model parameters of LDA . Then , transition patterns and their top k snippets are computed similarly to TOPTRAC .
5.1 Data Sets
For real life data sets , we collected geo tagged messages using the Streaming API of Twitter[14 ] from May , 25th to May , 31st in 2014 . We used two data sets of geo tagged messages collected in two cities , which are New York city and San Francisco , USA and we will denote them as NYC and SANF respectively . The data set NYC includes 9 , 070 trajectories with 266 , 808 geo tagged messages . In SANF , there are 809 trajectories with 19 , 664 messages . For both data sets , we eliminated stop words which appear less than 5 times or occur in more than 10 % of all messages and removed the messages including some words which obviously have no local context such as insults .
592 ( 1 ) @ Yankee Stadium http://t.co/* ( 2 ) This was for dinner . #NYC #bestrestaurant #foodporn @ The Halal Guys http://t.co/* ( 1 ) I’m at Yankee Stadium @mlb ( Bronx , NY ) http://t.co/* ( 2 ) I’m at Wa Bar + Kitchen @wabarnyc ( New York , NY ) http://t.co/* ( 1 ) We are here for the gamew ( @ Yankee Stadium Gate 8 w/ 7 others ) http://t.co/* ( 2 ) I’m at O’Donoghues Bar & Restaurant @odonoghuests ( New York , NY ) w/ 2 others http://t.co/*
( b ) From ‘Yankee Stadium’ to Downtown for ‘Dinner’
( 1 ) Morning @ Central Park 5av and 59th Street NYC http://t.co/* ( 2 ) Just posted a photo @ Egg Restaurant http://t.co/* ( 1 ) I’m at The Biergarten at The @StandardHotels ( New York , NY ) w/ 17 others http://t.co/* ( 2 ) Brunching ( at @Allswell nyc ) http://t.co/* ( 1 ) #nyc icon . @ Empire State Building http://t.co/* ( 2 ) Brunch time . #nyc #brooklyn @ Juliette Restaurant http://t.co/*
( d ) From Downtown to Brooklyn for ‘Brunch’
( 1 ) I’m at Apple Store ( New York , NY ) w/ 7 others http://t.co/* ( 2 ) I’m at @DunkinDonuts ( Maspeth , NY ) https://t.co/* ( 1 ) I’m at Chipotle Mexican Grill ( New York , NY ) w/ 4 others http://t.co/* ( 2 ) I’m at Brooklyn Bagel & Coffee Company ( Astoria , NY ) w/ 2 others http://t.co/* ( 1 ) I’m at Union Square Park @nycparks ( New York , NY ) w/ 31 others http://t.co/* ( 2 ) I’m at New York City Bagel & Coffee House @nycbch ( Astoria , NY ) http://t.co/*
( f ) From Downtown to Brooklyn for ‘Bagel’
Figure 7 : Interesting transition patterns in NYC
( a )
( c )
( e )
5.2 Quality of Transition Patterns
We conducted our experiments with varying the number of latent semantic regions M , the number of latent topics K and the minimum support τ . The default values of these parameters for each data set were : M =30 , K=30 , τ =100 for NYC , and M =20 , K=20 , τ =10 for SANF . The time interval ∆ between two regions in a transition was set to 6 hours and the default value of k for the top k representative transition snippets was 15 . Furthermore , the hyper parameters ~α , ~β and ~γ were updated between the iterations of the EM step using Newton method as LDA[2 ] does .
Quality measures : We computed the spatial sparsity , topical coherence and topical anti diversity for evaluating the quality of each transition pattern which have been utilized to measure the quality of clusters[13 ] . Given a pattern with top k transition snippets {h( ~Gf rom the spatial sparsity is the average distance between every pair of geo tags in each set of ~Gf rom s and ~Gto
, wf rom i s , which is
) , ( ~Gto i , wto i i i i )i}i=1,,k ,
2
1 2 i i j k−1 k k−1 k
) ) +
Xi=1 d( ~Gto i , ~Gto
Xi=1
, ~Gf rom d( ~Gf rom s and wto
Xj=i+1
Xj=i+1 k(k − 1 )   j ))  where d( ~G1 , ~G2 ) denotes the Euclidean distance between 2dimensional vectors . Furthermore , the topical coherence is the average Jaccard similarity between every pair of messages in each set of wf rom i s , which can be computed similarly to the spatial sparsity by substituting d( ~G1 , ~G2 ) with the Jaccard similarity sim(w1 , w2 ) in the above equation . The topical anti diversity is the similarity between the different semantic region shown in the transition patterns . Given a pair ( r , z ) of the latent semantic region and topic , let A(r,z ) denote the set of words in the messages chosen for the top k transition snippets which are posted in r with topic z . The topical anti diversity is defined as the average Jaccard similarity between A(r,z ) and A(r′,z′ ) with every different ( r , z ) and ( r′ , z′ ) which have been appeared in the snippets . Illustrative Cases : We first present the interesting transition patterns found by TOPTRAC using real life data which are selected among the patterns whose topical coherence are larger than 005 We show three transition patterns with their top 15 snippets found from NYC in Figures 6(a) (c ) . The pattern shown in Figure 6(a ) captures the movement of e c n e r e h o c l i a c p o T
0.16 0.14 0.12 0.1 0.08 0.06 0.04 0.02 0
10
K=10 K=20 K=30
20
30
40
M y t i s r e v d i l i a c p o T
0.1 0.09 0.08 0.07 0.06 0.05 0.04 0.03 0.02
10
K=10 K=20 K=30
20
30
40
M
( a ) Topical coherence
( b ) Topical anti diversity
K=10 K=20 K=30 y t i s r a p s l a i t a p S
0.032
0.028
0.024
0.02
0.016
0.012
10
20
30
40
M
( c ) Spatial sparsity
Figure 9 : Quality of TOPTRAC varying M and K people who first visit ‘Empire State Bldg.’ and then transport themselves to ‘Williamsburg waterfront pier’ to see the Manhattan skyline . The representative snippets selected for this pattern are ( ‘Sunset on the Empire’ , ‘Just a photo @ Williamsburg Waterfront’ ) and ( ‘NYC at night from top of the Empire State Building’ , ‘That Manhattan skyline’ ) .
In Figures 6(b) (c ) , we can see that TOPTRAC splits the latent semantic regions for ‘Battery park’ and ‘9/11 Memorial center’ desirably which are located close to each other , while the extended traditional method LGTA fails to split them as shown in Figure 6(d ) . This is because our model gives larger weights on the latent semantic regions which are visited by many people who moved in from another identical region with a coherent topic . Usually , tourists or people looking for popular restaurants , coffee shops or attractions create useful and interesting patterns .
To obtain finer granularities for LGTA and NAIVE , we can use larger number of regions in each method . However , as we increase the number of regions , we found that the transitions patterns obtained by these algorithms are mostly trivial and boring . In Figure 6(h ) , we present a typical transition pattern discovered by NAIVE when the number of regions was 70 for the data set SANF . It is a trivial transition
593 TOPTRAC
M 20 30 40
Q1
0.0816 0.1047 0.102
Q2
0.0178 0.0126 0.0124
Q3
0.0576 0.0459 0.0463
Q4
0.0364 0.0512 0.0548
M 70 100 150
TOPTRAC
M 10 20 30
Q1
0.0867 0.0772 0.0915
Q2
0.0293 0.0196 0.0172
Q3
0.0941 0.0828 0.1018
Q4
0.0396 0.0464 0.0501
M 30 40 50
Q1
LGTA Q2
0.0048 0.006 0.0061
0.023 0.0301 0.025
Q3
0.0602 0.0595
0.05 ( a ) NYC data set
Q1
LGTA Q2
Q3
0.0272 0.0277 0.0072
0.7340 0.4553 0.3274
0.8454 0.4928 0.6780 ( b ) SANF data set
Q4
0.0068 0.0067 0.008
M 70 100 150
Q1
0.042 0.061 0.057
NAIVE Q2
0.0142 0.0138 0.013
Q3
0.0326 0.038 0.0293
Q4
0.0133 0.022 0.0169
Q4
0.0134 0.0125 0.015
M 50 70 100
Q1
0.0072 0.0414 0.0256
NAIVE Q2
0.6274 0.0261 0.0311
Q3
0.678 0.0707 0.0581
Q4
0.015 0.0487 0.0522
Figure 10 : Quality of clusters ( Q1:topical coherence , Q2 : spatial sparsity , Q3 : distance , Q4 : topical antidiversity ) pattern shown in a small area with messages such as ‘You bet!’ or ‘Lunch time’ . In contrast , TOPTRAC found the interesting patterns including not only small latent semantic regions such as ‘Sausalito’ in Figure 6(e ) or ‘Fisherswarf’ and ‘Chinatown’ in Figure 6(f ) but also the regions with much larger area such as ‘Winery’ as shown in Figure 6(g ) . Furthermore , we present more illustrative cases found in NYC in Figure 7 with their transition snippets . These cases show that TOPTRAC can discover interesting topical transition patterns with good representative snippets .
Comparative study : By varying the number of regions M , we evaluated the performance of the implemented algorithms in terms of spatial sparsity , topical coherence and topical anti diversity , and presented the result in Figure 10 . We set K and τ to the default values for each data set . The range of M in each algorithm is selected as the values with which each one achieves the best performance . The result confirms that TOPTRAC outperforms the other algorithms especially with respect to topical coherence .
NAIVE obtained the next largest topical coherence . However , this is because if M is large , it finds transition patterns appearing in a very small area created by active users who post very personal and daily talks as we discussed with the illustrative case in Figure 6(h ) . As evidence , we can find that the average distance ( Q3 ) between starting and ending locations of patterns becomes smaller with growing M .
In addition , LGTA was even worse than NAIVE algorithm in terms of both quality measures : topical coherence and spatial sparsity . This is because LGTA is sensitive to noisy messages ( ie , daily talks without local contexts ) and sparsely distributed geo tags since LGTA tends to find large semantic regions to capture the common topics among the noisy messages .
Distribution of patterns : With NYC and SANF , we plotted the transition patterns in Figure 8 where x axis and y axis are the topical coherence and spatial sparsity respectively . The graphs show that TOPTRAC identifies transition patterns with high topical coherence and low spatial sparsity well while LGTA and NAIVE fail to find any transition pattern with high topical coherence . Most of the patterns found by LGTA and NAIVE also obtained small spatial sparsity , simply because trivial patterns are captured in small areas by using a large number of regions as we discussed before .
Furthermore , the graphs show that TOPTRAC is able to find transition patterns which not only indicate strong topical coherence but also involve large semantic regions well , such as the transition to ‘Winery’ shown in Figure 6(g ) .
Varying M and K for TOPTRAC : With varying the numbers of regions M and topics K , we plotted the quality of TOPTRAC in Figure 9 for NYC data set . As we increase M , the topic coherence grows gradually with every range of K as shown in Figure 9(a ) since TOPTRAC can generate more semantic regions with large M . The spatial sparsity is decreased with varying M from 10 to 30 but rises when M is larger than 30 in in Figure 9(c ) . This is because the messages posted without local context happen to be clustered in large latent semantic regions as M is large enough to group those noisy messages into semantic regions . We actually have confirmed that the latent semantic regions with a large determinant are produced when M is large .
Furthermore , the larger K we use , the higher topical coherence we obtain because we can split semantic regions with a finer granularity . However , if we set larger value of K than 30 , a topic can be divided into several topics ( ie , a single topic can be represented with a mixture of more than a topic ) , and it results in that few patterns are identified by our TOPTRAC MLS algorithm . Thus , the graphs confirms that TOPTRAC achieved the best performance with M =30 and K=30 which are the default setting for NYC . The default setting for SANF was also determined similarly .
6 . CONCLUSION
In this paper , we proposed a trajectory pattern mining algorithm , called TOPTRAC , using our probabilistic model to capture the spatial and topical patterns of users , who transport themselves while posting geo tagged messages in micro blogging services . We developed an efficient inference algorithm for our model and also devised algorithms to find frequent transition patterns as well as the best representative snippets of each pattern . Our experiments using reallife data sets confirmed that our method not only discovers useful and interesting transition patterns , but also identifies important semantic regions with refined granularity .
Acknowledgment This work was sponsored in part by the US Army Research Lab . under Cooperative Agreement No . W911NF 09 2 0053 ( NSCTA ) , National Science Foundation IIS 1017362 , IIS1320617 , and IIS 1354329 , HDTRA1 10 1 0120 , and grant 1U54GM114838 awarded by NIGMS through funds provided by the trans NIH Big Data to Knowledge ( BD2K ) initiative ( wwwbd2knihgov ) , and MIAS , a DHS IDS Center for Multimodal Information Access and Synthesis at UIUC . It was also partially supported by the research fund of Hanyang University(HY 2014 N ) and Aero Science Fund of China2013ZD51058 .
594 7 . REFERENCES [ 1 ] J . Bilmes . A gentle tutorial of the em algorithm and its application to parameter estimation for gaussian mixture and hidden markov models . Technical report , 1998 .
[ 2 ] D . M . Blei , A . Y . Ng , and M . I . Jordan . Latent dirichlet allocation . Journal of Machine Learning Research , 3:993–1022 , 2003 .
[ 3 ] Z . Chen , H . T . Shen , and X . Zhou . Discovering popular routes from trajectories . In ICDE , 2011 .
[ 4 ] F . Giannotti , M . Nanni , D . Pedreschi , and F . Pinelli .
Trajectory pattern analysis for urban traffic . In IWCTS , 2009 .
[ 5 ] F . Giannotti , M . Nanni , F . Pinelli , and D . Pedreschi .
Trajectory pattern mining . In SIGKDD , 2007 .
[ 6 ] T . Hofmann . Probabilistic latent semantic indexing . In
SIGIR , 1999 .
[ 7 ] L . Hong , A . Ahmed , S . Gurumurthy , A . J . Smola , and
K . Tsioutsiouliklis . Discovering geographical topics in the twitter stream . In WWW , 2012 .
[ 8 ] B . Hu and M . Ester . Spatial topic modeling in online social media for location recommendation . In RecSys , 2013 .
[ 9 ] M . I . Jordan , Z . Ghahramani , T . Jaakkola , and L . K . Saul .
An introduction to variational methods for graphical models . Machine Learning , 37(2):183–233 , 1999 .
[ 10 ] T . Kurashima , T . Iwata , G . Irie , and K . Fujimura . Travel route recommendation using geotags in photo sharing sites . In CIKM , 2010 .
[ 11 ] J G Lee , J . Han , and K Y Whang . Trajectory clustering : a partition and group framework . In SIGMOD Conference , 2007 .
[ 12 ] L . R . Rabiner . A tutorial on hidden markov models and selected applications in speech recognition . In PROCEEDINGS OF THE IEEE , 1989 .
[ 13 ] Y . Sun , Y . Yu , and J . Han . Ranking based clustering of heterogeneous information networks with star network schema . In SIGKDD , 2009 .
[ 14 ] Twitter . Streaming api . http://devtwittercom/ , 2014 . [ 15 ] Wikipedia . Jensen ’s inequality . http://enwikipediaorg/wiki/Jensen ’s inequality , 2013 .
[ 16 ] Z . Yin , L . Cao , J . Han , J . Luo , and T . S . Huang .
Diversified trajectory pattern ranking in geo tagged social media . In SDM , 2011 .
[ 17 ] Z . Yin , L . Cao , J . Han , C . Zhai , and T . S . Huang .
Geographical topic discovery and comparison . In WWW , 2011 .
[ 18 ] C . Zhang , J . Han , L . Shou , J . Lu , and T . L . Porta . Splitter :
Mining finegrained sequential patterns in semantic trajectories . In VLDB , 2014 .
[ 19 ] Y . Zheng , L . Zhang , X . Xie , and W Y Ma . Mining interesting locations and travel sequences from gps trajectories . In WWW , 2009 .
APPENDIX
A . AN EXTENSION OF LGTA
In [ 17 ] , Yin et al . proposed an algorithm , called LGTA , to discover latent semantic regions using the GPS location and user generated tags submitted to the photo sharing services such as Flickr . Without considering any dependency between messages in sequences , LGTA discovers the region in which the messages are posted with the same topic preference . Since their model focuses on finding latent semantic regions only , LGTA does not provide a method to find transition patterns . However , by utilizing the simple Markov model as proposed in [ 10 ] , we can extend LGTA to handle our transition pattern mining problem .
LGTA assumes that when the number of latent semantic regions is M , the messages posted in the same latent semantic region are generated by following the same mixture of topic distributions , where the region is also determined probabilistically . Let rt,i denote the latent semantic region of the message mt,i=( ~Gt,i , wt,i ) . For each geo tagged message mt,i , words in the message wt,i are selected repeated similarly to PLSI[6 ] or LDA[2 ] model and the geo tag ~Gt,i is chosen by the Gaussian distribution of region rt,i .
Extended LGTA : Using the model parameters estimated by LGTA , we find transition patterns and their snippets as follows : After running the inference algorithm in [ 17 ] , for each geo tagged message mt,i , we can compute the most likely semantic region r which maximizes the likelihood P r(mt,i |Rt,i = r ) , which is the probability to submit mt,i in the region r . Let SM L be the set of the sequences of the most likely latent semantic region rt,i for each message mt,i in C . Given SM L and the minimum support τ , transition patterns are every subsequence with length 2 , hr1 , r2i with r16=r2 and 1≤r1 , r2≤M , which occurs at least τ times in SM L within a given time interval ∆ .
We next compute the top k transition snippets for each transition pattern . Let P r(r1 → r2 ) denote the conditional probability that a user posts one message in r1 and then submits another in r2 within the interval of ∆ . Then , P r(r1 → r2 ) is calculated as
P r(r1 → r2 ) =
N ( r1 , r2 )
N ( r1 ) where N ( r1 ) and N ( r1 , r2 ) denote the frequencies of the latent semantic region r1 and the subsequence hr1 , r2i appearing within ∆ in SM L respectively . Then , the top k transition snippets of each transition pattern hr1 , r2i are the k pairs of geo tagged messages hmt,i , mt,i+1i in C whose probabilities of posting mt,i in r1 and moving to r2 to submit mt,i+1 :
P r(r1 → r2 ) · P r(mt,i|Rt,i = r1 ) · P r(mt,i+1|Rt,i+1 = r2 ) are the k largest .
B . THE LOWER BOUND OF LOG LIKELIHOOD
By introducing the approximate parameters ~at , ~bk , ~ct , ~σt,i , ~ρt,i and ~ζt,i as summarized in Figure 4 , we obtain the lower bound of log likelihood F as follows :
F =
N
Nt
1
{σt,i,s(Ψ(ct,s ) − Ψ(ct,• ) ) − σt,i,s log σt,i,s}
σt,i,0 log 1/M +
N
M
Xt=1
Xr=1
σt,1,1ρt,1,r log ¯δr
N
M
σt,i−1,0σt,i,1ρt,i,rlog¯δr
σt,i−1,1σt,i,1ρt,i−1,r′ ρt,i,rζt,i−1,k log δr′ ,k,r
+
+
+
Nt
Nt
Nt
Xi=1 Xt=1 Xs=0 Xi=1 Xt=1 Xi=2 Xt=1 Xt=1 Xi=2 Xi=1 Xt=1 Xt=1 Xi=1 Xi=1 Xt=1
Nt
Nt
Nt
+
+
+
N
N
N
N
N
M
Xr=1
K
M
M
Xk=1
Xr=1 Xr′=1 Xr=1 Xk=1( M Xr=1 Xk=1 Xj=1
Nt,i
K
K
σt,i,1ρt,i,r log fr( ~Gt,i ) −
N
Xt=1
Nt
Xi=1
M
Xr=1
ρt,i,r log ρt,i,r
ρt,i,rζt,i,k(Ψ(ar,k ) − Ψ(ar,• ) ) − ζt,i,k log ζt,i,k )
ζt,i,k(Ψ(bk,wt,i,j ) − Ψ(bk,• ) )
595 +
−
+
−
+
−
V
K
K
K
M
M
Xr=1(log Γ(α• ) − Xk=1 Xr=1(log Γ(ar,• ) − Xk=1 Xk=1(log Γ(β• ) − Xv=1 Xk=1(log Γ(bk,• ) − Xv=1 Xt=1(log Γ(γ• ) − Xs=0 Xt=1(log Γ(ct,• ) − Xs=0
K
N
N
V
1
1 log Γ(αk ) + log Γ(ar,k ) + log Γ(βv ) + log Γ(bk,v ) + log Γ(γs ) + log Γ(ct,s ) +
V
K
K
( αk − 1)(Ψ(ar,k ) − Ψ(ar,•) ) ) ( ar,k − 1)(Ψ(ar,k ) − Ψ(ar,•) ) )
Xk=1 Xk=1 ( βv − 1)(Ψ(bk,v ) − Ψ(bk,•) ) ) Xv=1 ( bk,v − 1)(Ψ(bk,v ) − Ψ(bk,•) ) ) Xv=1 ( γs − 1)(Ψ(ct,s ) − Ψ(ct,•) ) ) ( ct,s − 1)(Ψ(ct,s ) − Ψ(ct,•) ) )
V
1
Xs=0 Xs=0
1
( 5 ) where ar,• , bk,• and ct,• represent PK P1 s=0 ct,s respectively . k=1 ar,k , PV v=1 bk,v and
C . DERIVATION OF EM STEPS
In the variational EM Steps , we calculate the variational parameters maximizing the lower bound F in Equation ( 5 ) repeatedly . In this section , we derive the update equations for the variational parameters at,k , bk,v , ct,s , σt,i,s , ρt,i,r and ζt,i,k by using the method of Lagrange multipliers .
Update equations of ar,k , bk,v and ct,s : We first compute the derivative F with respect to ar,k as follows .
∂F
∂ar,k
= Ψ′(ar,k)
+ Ψ′(ar,• )
N
Nt
K
Xi=1 Xt=1 αa,k +  Xk′=1 Xt=1 αa,k′ +
N
Nt
Xi=1
ρt,i,rζt , i , k − ar,k 
ρt,i,rζt , i , k′ − ar,k′
 = 0
Then , the solution of ar,k which always satisfies the above equation is ar,k = αk +
T
Xt=1
Nt
Xi=1
ρt,i,rζt,i,k
( 6 )
In a similar way , the update equations of bk,v and ct,s can be derived as follows : bk,v = βv + ct,s = γs +
T
Nt,i
Xt=1 Xi=1
I(wt,i,j =v)ζt,i,k
Nt
Xi=1
Nt,i
Xj=1
σt,i,s
( 7 )
( 8 ) where Icondition denotes the indicator function which gives 1 if the condition holds and 0 otherwise .
Update of σt,i,s : Similarly , we next derive the update equation of σt,i,s , which is a variational parameter for the distribution q(Rt,i ) as shown in Figure 4 , by differentiating F with σt,i,s as shown below :
σt,i,0 ∝ exp(Ψ(ci,0 ) + log σt,i,1 ∝ exp(Ψ(ci,1 ) +
M
Xr=1
1 M
+
M
Xr=1
σt,i+1,1ρt,i+1,r log δ0,r + log f0 )
( σt,i−1,0 )
I(i>1 ) ρt,i,r log δ0,r
+
M
K
M
Xr=1
Xk=1
Xr′=1
( I(i>1)σt,i−1,1ρt,i−1,rζt,i−1,kρt,i,r′
+σt,i+1,1ρt,i,rζt,i,kρt,i+1,r′ ) log δr,k,r′ +
M
Xr=1
ρt,i,r log fr( ~Gt,i ) )
( 9 )
Note that σt,i,0 + σt,i,1 = 1 holds for every t = 1 , . . . , N and i = 1 , . . . , Nt .
Update of ρt,i,r : The variational parameter ρt,i,r of the distribution q(Rt,i ) is computed as follows
M
ρt,i,r ∝ expn(σt,i−1,0)Ii>1 σt,i,1 log δ0,r Xr′=1
Xk=1
K
( Ii>1σt,i−1,1σt,i,1ζt,i−1,kρt,i−1,r′ log δr′ ,r
+ σt,i,1σt,i+1,1ζt,i,kρt,i+1,r′ log δr,r′ )
K
+
ζt,i,k(Ψ(ar,k ) − Ψ(ar,• ) ) + σt,i,1 log fr( ~Gt,i ) ) Xk=1 where PM r=1 ρt,i,r = 1 is satisfied for every t = 1 , . . . , N and i = 1 , . . . , Nt .
( 10 )
Update of ζt,i,r : We next take the derivative of F with regard to each of ζt,i,k , which is a variational parameter for the distribution q(Zt,i ) , and obtain the update equation as
ζt,i,k ∝ exp  Xr=1
+
M
ρt,i,rΨ(ar,k ) +
M
M
Xr=1
Xr′=1
σt,i,1σt,i+1,1ρt,i,rρt,i+1,r′ log δr,k,r′
Nt,i
Xj=1
( Ψ(bk,wt,i,j ) − Ψ(bk,•))  k=1 ζt,i,k = 1 for every
( 11 ) where ζt,i,k is normalized to satisfy PK t = 1 , . . . , N and i = 1 , . . . , Nt .
Update of ¯δr and δr,k,r′ : We also obtain the update equations for ¯δr and δr,k,r′ as
¯δr ∝
T
Nt
X
X t=1 i=1
( σt,i−1,0)Ii>1 σt,i,1ρt,i,r
( 12 )
δr,k,r′ ∝
T
Nt
K
X
X
X t=1 i=2 k=1
σt,i−1,1σt,i,1ρt,i−1,rρt,i,r′ ζt,i−1,k
( 13 )
Note that PM r′=1
¯δr′ = 1 and PM r = 1 , . . . , M and k = 1 , . . . , K . r′=1 δr,k,r′ = 1 for every
Update of µr and Σr : We finally calculate µr and Σr , which is the center and covariance matrix of the r th region defined in Equation ( 1 ) , as i=1 σt,i,1ρt,i,r ~Gt,i i=1 σt,i,1ρt,i,r t=1PNt ~µr = PT t=1PNt PT t=1PNt Σr = PT t=1PNt PT i=1 σt,i,1ρt,i,r( ~Gt,i − ~µr)( ~Gt,i − ~µr)⊤
( 14 ) i=1 σt,i,1ρt,i,r
596
