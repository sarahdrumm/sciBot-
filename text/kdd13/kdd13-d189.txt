U Air : When Urban Air Quality Inference Meets Big Data
Yu Zheng , Furui Liu , Hsun Ping Hsieh
Microsoft Research Asia , Beijing China
{yuzheng , v ful , v hshsie}@microsoft.com
ABSTRACT Information about urban air quality , eg , the concentration of PM2.5 , is of great importance to protect human health and control air pollution . While there are limited air quality monitor stations in a city , air quality varies in urban spaces non linearly and depends on multiple factors , such as meteorology , traffic volume , and land uses . In this paper , we infer the real time and finegrained air quality information throughout a city , based on the ( historical and real time ) air quality data reported by existing monitor stations and a variety of data sources we observed in the city , such as meteorology , traffic flow , human mobility , structure of road networks , and point of interests ( POIs ) . We propose a semi supervised learning approach based on a co training framework that consists of two separated classifiers . One is a spatial classifier based on an artificial neural network ( ANN ) , which takes spatially related features ( eg , the density of POIs and length of highways ) as input to model the spatial correlation between air qualities of different locations . The other is a temporal classifier based on a linear chain conditional random field ( CRF ) , involving temporally related features ( eg , traffic and meteorology ) to model the temporal dependency of air quality in a location . We evaluated our approach with extensive experiments based on five real data sources obtained in Beijing and Shanghai . The results show the advantages of our method over four categories of baselines , including linear/Gaussian interpolations , dispersion models , well known classification models like decision tree and CRF , and ANN . classical
Categories and Subject Descriptors H28 [ Database Management ] : Database Applications data mining , Spatial databases and GIS ;
General Terms Algorithms , Management , Experimentation
Keywords Air quality , city dynamics , human mobility , spatial trajectories .
1 . INTRODUCTION Real time air quality information , such as the concentration of NO2 , PM2.5 , and PM10 , is of great importance to support air pollution control and protect humans from damage by air pollution . In reality , however , there are insufficient air quality measurement stations in a city due to the expensive cost of building and maintaining such a station . As demonstrated in Figure 1 A ) , an air quality monitor station usually needs a certain size of land , non trivial money ( about 200,000 USD for construction and 30,000 USD per year for maintenance ) , and human resources to regularly take care of it . As a result , for instance , Beijing only has 22 stations covering a 50 × 50km land(113km2/per station ) , as illustrated in Figure 1 B ) .
Figure 1 . Examples of air quality monitor stations
Unfortunately , urban air quality varies by locations non linearly and depends on multiple factors , such as meteorology , traffic , land use , and urban structures . As depicted in Figure 2 A ) , the air quality indices ( AQIs ) reported by stations and are quite different at 11am on 3/27/2013 , though they are geospatially close ( about 3km away ) . As shown in Figure 2 B ) , the phenomenon is not a coincidence according to the distribution of the deviation between the PM2.5 of the two stations reported at the same time of day ( from Feb . 8 to May 27 , 2013 ) . Over 37 percent of the cases have a deviation greater than 100 . Figure 2 C ) further shows the mean deviation among the 22 stations in Beijing , changing over time of day . Figure 2 D ) presents the distribution of the deviation among these 22 stations cross 3 months . All these results well demonstrate the skew of air quality in urban spaces .
Figure 2 . The difference between AQIs from different stations
In this paper , we infer the real time and fine grained air quality information throughout a city using ( historical and real time ) air quality data reported by a limited number of existing monitor stations and a variety of data sets we observed in the city , such as meteorology , traffic flow , human mobility , structure of road networks , and POIs . Although environment scientists have been proposing models to approximate the relation between air quality and some factors like traffic and wind , these models are usually based on empirical assumptions and parameters that may not be
B ) Air quality measurement stations in BeijingS1S2S4S5S8S3S6S7S9S10S12S11S13S14S22S15S16S17S18S19S20S21A ) Configuration of a station S2S4S6S8S10S12S14S16S18S20S220100200300400500AQIStations in Beijing PM2.5 PM1004080120160200240280320360400440480000005010015020025030PortitionDeviation of PM2.5 between S12 and S1304080120160200240280320360400000002004006008010012014016018PortitionDeviation between PM2.50246810121416182022242030405060708090100110Mean Deviation of PM2.5Time of DayA ) Air quality reports from 22 stations in Beijing at 11am on 3/27/2013B ) Distribution of the deviation of PM2.5 between S12 and S13 C ) Deviation of PM2.5 among 22 stations in Beijing ( Feb . 8 to May 27 , 2013)D ) Distribution of the deviation of PM2.5 among 22 stations in Beijing ( Feb . 8 to May 27 , 2013)1436 applicable to all urban environments [ 9 ] ( detailed in the related work section ) . The methodology based on crowd and participatory sensing ( eg , using sensor equipped mobile phones ) could work for a very few kinds of gas like CO2 but not applicable to aerosols and other pollutants , such as PM2.5 , PM10 , and NO2 . The devices for detecting the latter pollutants are not easily portable and usually need a relatively long sensing period ( eg , 1~2hours ) before generating an accurate AQI .
Recently , big data reflecting city dynamics have become widely available [ 11][14 ] , eg , traffic flow , human mobility , and meteorology , enabling us to solve this challenging problem from a data perspective . According to existing studies [ 9 ] , these data have a strong correlation with air qualities ( detailed in Section 3 ) . Using machine learning and data mining techniques , we build a network between air quality labels and features observed across multiple heterogeneous data sources . Figure 3 A ) shows an example ( Sept . 19 , 2012 1pm in Beijing ) of the results inferred by our method ( U Air ) , demonstrating the advantage beyond linearinterpolation , as depicted in Figure 3 B ) . To verify the validity of our method , we first remove two stations ( and ) from Beijing ( marked with two boxes ) and predict the AQIs of the two with the rest of stations ( denoted by gray points ) . The reports of the two stations are then employed as a ground truth ( =M , =G ) to evaluate the prediction ( refer to Table 1 for the semantic meanings of the colors and AQI descriptors ) . Clearly , our method well reflects the ground truth , while linear interpolation generated incorrect results ( = =U S ) . The result also indicates another story . Besides providing accurate information of air quality , the research reported here can also suggest a location to setup a monitor station , where the inference of U Air always differs from that of linear interpolation .
Figure 3 . Results of PM10 generated by different methods
The challenges of our approach lie in three aspects . The first is to identify discriminative features from a variety of data sources . The second one is how to incorporate heterogeneous features into a data analytics model effectively . Equally treating these features does not work well . Third , the labeled data is insufficient though we have many observations represented by big data . While having many places to infer , only a few stations generate training data .
The contribution of this paper lies in the following three aspects :
 We propose a co training based semi supervised learning approach , which leverages unlabeled data to improve the inference accuracy . Additionally , the approach consists of two classifiers respectively modeling the spatial and temporal factors that influence air qualities .
 We identify spatially related ( such as POIs , road networks , and distance to an existing station ) and temporally related features ( eg , humidity , temperature , and traffic flow ) , contributing to not only our application but also the general problem of air quality inference . Moreover , instead of treating these features equally , we feed them into the corresponding classifier in the co training framework , therefore , leading to a high inference accuracy .
 We evaluated our approach using 5 data sources consisting of the POIs , road networks , meteorological data , and air quality records of Beijing and Shanghai , and the GPS trajectories generated by over 30,000 taxis in Beijing , justifying the advantages of our approach over 4 baselines .
2 . OVERVIEW 2.1 Preliminary Definition 1 : Air quality index . AQI is a number used by government agencies to communicate to the public how polluted the air is currently . As the AQI increases , an increasingly large percentage of the population is likely to experience increasingly severe adverse health effects . To compute the AQI requires an air pollutant concentration from a monitor or model . The function used to convert from air pollutant concentration to AQI varies by pollutants , and is different in different countries . Air quality index values are divided into ranges , and each range is assigned a descriptor and a color code . In this paper , we use the standard issued by United States Environmental Protection Agency , as shown in Table 1 . The descriptor of each AQI level is regarded as the class to be inferred , ie , ={G , M , U S , U , V U , H} , and the color is employed in the following visualization figures .
Table 1 AQI values , descriptors , and color codes
AQI 0 50 51 100 101 150 151 200 201 300 301 500
Values Levels of Health Concern Good ( G ) Moderate ( M ) Unhealthy for sensitive groups ( U S ) Unhealthy ( U ) Very unhealthy ( VU ) Hazardous ( H )
Colors Green Yellow Orange Red Purple Maroon
Definition 2 : Trajectory . A spatial trajectory is a sequence of time ordered spatial points , , where each point has a geospatial coordinate set and a timestamp , .
Definition 3 : POI . A point of interest POI is a venue ( like a school and shopping mall ) in the physical world , having a name , address , coordinates , category , and other attributes .
Definition 4 : Road Network . A road network is comprised of a set of road segments connected among each other in a format of graph . Each road segment is a directed edge having two terminal points , a list of intermediate points describing the segment , a length , and a level denoting its capacity .
Figure 4 . Illustration of grid , affecting region , POI , and trajectory
Definition 5 : Grid and Affecting Region . We divide a city into disjointed grids ( eg , 1km×1km in the experiments ) as illustrated in Figure 4 A ) , assuming the air quality in a grid is uniform ( while different grids may have different results ) . Each has a geospatial coordinate and a set of AQI labels to be inferred or already associated if having an air quality monitor station located . Here , denotes the type of
A ) U AirB ) Linear interpolationS1S2S2S1A ) Grid and its neighborsB ) Data from the affecting regionC ) POI density1437 pollutants , and ( defined in Table 1 ) means the AQI label of the k th type of pollutant , such as PM10 . We believe the air quality of a grid ( filled by slashes in Figure 4 A ) ) would be influenced by the data ( eg , trajectories and POIs ) observed in the affecting region that consists of the grid and its eight neighbor grids , as shown in Figure 4 B ) .
2.2 Framework As shown in Figure 5 , our framework consists of two major parts , offline learning and online inference , which generate three kinds of data flows : preprocessing , inference , and learning data flows .
Preprocessing data flow : In this flow ( denoted by dotted black arrows ) , we receive spatial trajectories generated by vehicles ( taxicabs in the experiments ) and map each trajectory onto a road network using a map matching algorithm [ 12 ] . The mapped data is then stored in a trajectory database for offline learning and also geo indexed to improve the efficiency of online inference .
Figure 5 . Framework of our system
Learning data flow : In this data flow ( represented by broken blue arrows ) , we first extract features for each grid from a variety of data observed in its affecting region . In terms of spatio temporal properties , these features can be categorized into two sets . One set is temporally related ( ie , the value of the features vary with time ) , such as temperature , humidity , and average speed of vehicles , which are extracted from meteorological data and the spatial trajectories . The other feature set is only spatially related , eg , the density of POIs and the length of roads in a region , extracted from POI and road network databases . See Section 3 for details .
If an air quality monitor station is located in a grid , the grid is labeled by the AQIs reported from the station . The features extracted from the data observed in the affecting region of such a grid and the corresponding labels formulate a training set . As we only have a few air quality stations in a city while there are many places to infer , the data with labels are very few . To address this issue , we propose a semi supervised learning approach based on co training , where unlabeled data are used to improve the inference accuracy . Two separate classifiers are first trained respectively based on the labeled data using two separated feature sets . One is a temporal classifier ( TC ) based on a linear chain conditional random field ( CRF ) , which uses temporally related features to estimate the temporal transformation of air quality in a location . The other is an artificial neural network ( ANN) based spatial classifier ( SC ) that uses spatially related features to model the spatial correlations between air qualities of different locations . The AQIs reported by existing stations are also employed as an input in the SC . As different air pollutants ( eg , NO2 and PM10 ) are influenced by these factors differently , we build an individual model for each kind of pollutant , as detailed in Section 4 .
Inference data flow : In this flow ( denoted as the red solid arrows ) , we calculate the features for each grid based on the data observed in the grid ’s affecting region . While the spatially related features like distribution of POIs can be calculated offline , the temporallyrelated features are computed online ; eg , the traffic related features are extracted based on the spatio temporal ( ST) index built in the preprocessing flow . For each grid , we respectively feed the spatially related features into the SC and temporallyrelated features into TC , generating two probability scores . By multiplying the two scores , we can select the most possible class as a label . As monitor stations usually update the reports every hour , we conduct the inference every hour . Detailed in Section 4 .
Problem statement Given a collection of grids , where ( ) is known and is unobserved ( ) , , a road network crossing , POIs located in , a trajectory dataset passing , and meteorological data of , we aim to infer , at periodic intervals , eg , every 1 hour .
3 . FEATURE EXTRACTION
3.1 Meteorological Features : Fm The concentration of air pollutants is influenced by meteorology . Accordingly , we identify five features : temperature , humidity , barometer pressure , wind speed , and weather ( such as cloudy , foggy , rainy , sunny , and snowy ) . Figure 6 shows the correlation matrix between the AQI of PM10 and the first four features , using the data we collected from August to Dec . 2012 in Beijing , where each row/column denotes one feature and a plot means the AQI label of a location . Apparently , a high wind speed disperses the concentration of PM10 , and high humidity usually causes a high concentration . A high pressure would result in a good AQI . The impact of temperature is not very clear , but , a good AQI is more likely when temperature is high and humidity is low , or when pressure is high and temperate is low . In short , these features are very discriminative in AQI inferences .
Figure 6 . Correlation matrix between Fw and PM10
3.2 Traffic Related Features : Ft It is widely believed that traffic flow is one of the major sources generating air pollutants that could damage air quality [ 9 ] , though researchers are still exploring the specific correlation . Here , we identify the following three features for each grid . These features are calculated from the spatial trajectories of vehicles traversing the grid in the past hour :
Learning data flowInference data flowOffline LearningST indexGeo IndexingPOIs/Road networksAQI RecordsTrajectory DBMeteorological dataFeature ExtractionFeature ExtractionInferenceModelsFeaturesEvaluationResultsOnline InferenceMap MatchingPreprocessing data flowTrafficMobilityWeatherPOI/RDANNAQIsUnlabeled dataCRFCo TrainingTemporalSpatialVisual.GoodModerateUnhealthyUnhealthy SVery Unhealthy1438 1 ) Expectation of speeds : . Given a spatial trajectory generated by a vehicle , we retrieve the points that fall in the affecting region of each gird ( let us say ) . We calculate the distance between any two consecutive points , then compute the speed of each vehicle at each point according to Equation 1 . As the sampling rate of each GPS device is different , we calculate the expectation of speed wrt time as Equation 2 , which denotes the overall travel speed of vehicles in .
∑
∑
, ( 1 )
, ( 2 )
2 ) Standard deviation of speeds : . We calculate the feature according to Equation 3 , which reflects how variably different vehicles were traveling in in the past hour . Similar to Equation 2 , it is normalized based on time .
∑ √
∑
. ( 3 )
3 ) The distribution of speeds : . We employ a widely used empirical setting to discretize the speed into three intervals ( ie , 0 20 , 20 40 , and 40 ) , calculating the distribution of speeds over the three intervals in terms of Equation 4 .
∑
∑
( 4 )
Figure 7 shows the correlation matrix between the aforementioned traffic features and NO2 , where each row/column still denotes one feature and a plot denotes the AQI of a grid . Here , is extracted from a GPS trajectory dataset generated by over 30,000 taxicabs . As taxis generate about 20 % of traffic flow on road surfaces of Beijing [ 14 ] , the dataset is big enough to represent the traffic patterns there . Additionally , GPS equipped taxis can be regarded as mobile sensors probing the travel speed of each road . As a result , the features wrt speeds are reliable [ 13 ] . on the first row and the third column).This is very intuitive to understand given the fact that more air pollutants would be issued by a vehicle when traveling in a traffic jam , ie , the gasoline would not be burned efficiently . A surprising discovery is that a bigger indicates a better air quality while a smaller one has a very high probability of resulting in a worse AQI of NO2 , as depicted in the fifth column of Figure 7 . It is actually very reasonable if we consider the speed limitation of different road segments . If there is no traffic jam , vehicles should travel with quite different speeds on different roads , eg , vehicles traveling on highways ( with a speed limitation of 120km/h ) should move much faster than those on a local street ( usually with a speed limitation of 40km/h ) . As a grid could contain road segments of different speed limitations , tends to be large when the traffic condition in the grid is not bad . On the contrary , every vehicle has to move very slowly in a traffic jam , leading to a small . The results well matches the commonsense that traffic jams cause much heavier air pollution than normal traffic conditions .
3.3 Human Mobility Features : Fh is comprised of two features , denoting the number of people arriving at ( ) and departing from ( ) a grid ’s affecting region in the past hour . In practice , people themselves are not major air pollutant generators . Human mobility , however , implies useful information , such as land use of a location , traffic flow , and function of a region ( like residential or business areas ) [ 11 ] , which could contribute to air quality inference . In the experiment , we extract the two features from the aforementioned taxi trajectories because the data tell the pickup and drop off points of each trip . The feature can actually be extracted from other data sources or a combination of multiple datasets , like mobile phone signal .
Figure 8 shows the correlation between AQIs and the human mobility features . Apparently , the concentration of PM10 in a grid becomes denser when the number of people arriving at and departing from increases . When and becomes very small , however , there might be two results . One is a very good AQI ; the other is very unhealthy . Both results actually make sense , as these places may have nature parks ( good ) or factories ( unhealthy ) with very few people traveling to .
Figure 7 . Correlation matrix between traffic features and NO2
Clearly , the more vehicles traveling with a speed smaller than 20km/h , ie , when 20 ) becomes larger , more instances of unhealthy and very unhealthy occurred . On the contrary , the larger 40 ) is the better AQI would be ( eg , see the sub chart
Figure 8 . The correlation between AQIs and human mobility
While the traffic related and human mobility features are calculated online , the feature extraction is very time consuming . To address this issue , we build a ST index between grids and the trajectories [ 5 ] , as illustrated in Figure 9 , where each grid is associated with two first in first out lists respectively storing the taxi IDs traversing a grid and the pickup/drop off points falling in the grid in the past hour . The two lists are sorted by arriving time and pickup/drop off time respectively , and the trajectory data of a taxi is connected to the taxi ID by a hash table . Given an affecting region consisting of 9 grids ( refer to Figure 4 as an example ) , we merge the taxi IDs falling in these grids by checking the sorted list .
GoodModeratekmUnhealthy SVery UnhealthyUnhealthy0≤v<2020≤v<40v≥ 40E(v)D(v)A ) AQI of PM10B ) AQI of NO2flflfafaGoodModerateUnhealthyUnhealthy SVery UnhealthyGoodModerateUnhealthyUnhealthy SVery Unhealthy1439 We can then quickly retrieve the point data falling in the time interval from each trajectory by searching for the hash table .
Figure 9 . ST index between grids and trajectories .
3.4 Road network related features : Fr The structure of a road network has a strong correlation with its traffic patterns , therefore providing a good complement to traffic modeling . As demonstrated in Figure 4 A ) , we identify the following three features for each grid based on a road network database : 1 ) total length of highways , 2 ) total length of other ( low level ) road segments , and 3 ) the number of intersections in the grid ’s affecting region . Figure 10 presents the portion of instances with different AQI classes ( NO2 ) changing over and , by analyzing the data we collected in Beijing . The increase of road segments in a region significantly brings down the portion of good instances , enhancing the presence of U S and beyond instances . We however did not see the phenomenon wrt highways . We could say highways are relatively greener than other road segments in terms of generating air pollutants ( as it does not usually contain traffic lights ) . This is also the reason why we need to separate from .
3 ) The change in the number of POIs : . We compare the POI data of two consecutive quarters , calculating the change in the number of POIs in the following five categories ( C3 , C4 , C6 , C8 , and C12 ) in each grid ’s affecting region . The change implies the construction in which infrastructure was built or removed from a region . According to [ 9 ] , construction is one of the major sources of air pollutants , such as PM10 and NO2 .
4 . LEARNING AND INFERENCE We propose the model based on the framework of co training and the philosophy shown in Figure 11 , where a circle denotes a location and a plane means the states of these locations at a timestamp . We can understand the philosophy of the model from the perspective of the state of air quality . First , air quality has temporal dependency on its current observations and that of its previous state . For example , the AQI of a location tends to be good if the AQI of the past hour is also good . Second , the air quality of a location is also reflected by its spatial neighbors . For instance , the AQI of a location is likely to be bad if the air quality of the places close to the location is bad . We can also understand the model from the perspective of the generation of air pollutants . The AQI of a location is determined by the air pollutants issued in the location and that propagated from other locations .
Figure 10 . AQI of NO2 changing over and
3.5 POI related features : Fp The category of POIs and their density in a region indicate the land use and the function of the region as well as the traffic patterns in the region , therefore contributing to the air quality inference of the region . Some POI category may even have direct causal relation with air quality . For example , if a region has some chemical factories , its air quality tends to be bad . A park , however , usually leads to a good air quality . Accordingly , we identify the following three features for each grid :
1 ) The number of POIs in some categories in : . We count the number of POIs belonging to the categories shown in Table 3 .
Table 3 . Category of POIs we studied
C1 : Vehicle Services ( gas stations , repair ) C2 : Transportation spots C3 : Factories C4 : Decoration and furniture markets C5 : Food and beverage C6 : Shopping malls and Supermarkets
C7 : Sports C8 : Parks C9 : Culture & education C10 : Entertainment C11:Companies C12:Hotels and real estates
2 ) The portion of vacant places in : . As illustrated in Figure 4 C ) , we further divide a grid into small cells , counting the number of cells without a POI located . In short , the bigger the larger vacant places contained in a grid , therefore facilitating the dispersion of air pollutants ; eg , the upper subfigure in Figure 4 C ) shows more vacant places than the bottom one due to the presence of a lake .
Figure 11 . The philosophy of the inference model two different feature sets
4.1 Co Training Co training is a semi supervised learning technique that requires two views of the data . It assumes that each example is described by that provide different and complementary information about an instance . Ideally , the two feature sets of each instance are conditionally independent given the class , and the class of an instance can be accurately predicted from each view alone . Co training can generate a better inference result as one of the classifiers correctly labels data that the other classifier previously misclassified [ 8 ] .
Aligning with the co training framework , we propose a spatial classifier ( SC ) to model the spatial correlation and a temporal classifier ( TC ) to model the temporal dependency of AQI . The two models are integrated into a co training based learning framework presented in Algorithm 1 . As shown in line 3 and 4 ,
Algorithm 1 : U AIR Co Training Input : A set of features ( , , , , ) , some labeled grids , and a set of unlabeled grids , a threshold controlling the rounds
Output : The spatial classifier and temporal classifier TC . 1 . ; 2 . Do 3 . SC.Learning ( , , ) ; 4 . TC TC.Learning ( , , , ) ; 5 . Apply to each , for each class , pick grids that most confidently classifies as , and add them to .
6 . Apply TC to each , for each class , pick grids that TC most confidently classifies as , and add them to .
7 . ++ ; 8 . Until is empty or ; 9 . Return and ; gitdtdTaxi2Taxi7Taximdrop1drop2pickidropmearliestlatesttdtatata1hourTraj : p1→p2→→pnTaxi1TaxilTaximTraj : p1→p2→→pnTraj : p1→p2→→pntp00 22 44 6>60001020304050607080910Length of Highways ( KM ) Good Moderate Unhealthy S and beyond00 66 1212 18180001020304050607080910Length of Roads ( KM ) Good Moderate Unhealthy S and beyondA ) B ) fhfrPortionPortions2s1s3s4ls2s1s3s4ls2s1s3s4tit1t2lTimeGeospaceA location with AQI labels A location to be inferred Temporal dependencySpatial correlationPOIs : Spatial FhTemporalRoad Networks : FrFtFmMeteorologic:Traffic:Human mobility:Fp1440 we first train the two classifiers with two separated sets of features . The trained SC and TC are then used to infer unlabeled grids iteratively , adding the most confidently classified examples into the labeled dataset for the next round of training , until becomes empty or a certain rounds have been performed . When this algorithm ends , SC and TC are returned .
. ( 5 )
At the inference time , we apply and to the corresponding features separately , determining the AQI of a grid by the product of the two probability scores ( and ) generated by the two classifiers , defined in Equation 5 .
4.2 Temporal Classifier : TC The temporal classifier infers the air quality of a grid given the temporally related features consisting of , , and of the grid , using a linear chain CRF , which is a discriminative undirected probabilistic graphical model for parsing sequential data like natural language texts [ 4 ] . The advantage of CRFs over hidden Markov models is the relaxation of the independence assumptions between features . Additionally , CRFs avoid the label bias problem exhibited by maximum entropy Markov models . Figure 12 shows the graphical structure of the temporal classifier , which consists of two kinds of nodes . The gray nodes represent hidden state variables to be inferred given the sequence of observations denoted by white nodes , , , , } ( is a timestamp by hour , eg , 8am ) . The is structured to form a chain with an edge between each and , as well as having an AQI "label" belonging to . When conditioned on , the random variables obey the Markov property with respect to the graph :
= , where means and are neighbors in .
Figure 12 . The graphic presentation of the temporal model
The probability of a particular label sequence given observation sequence is defined as a normalized product of potential functions as follows :
∑
∑
, ( 6 ) where is a transition feature function of the entire observation sequence and the label at positions and ; is a state feature function of the label at position and the observation sequence ; and are parameters to be estimated from training data . Writing , we transfer Equation 6 to
∑
, ( 7 ) where is a normalized factor [ 4 ] . This can be informally thought of as measurements on the input sequence that partially determine the likelihood of each possible value for . The model assigns each feature a numerical weight and combines them to determine the probability of a certain value for . Given sequences of the training data { } , learning the parameters is done by maximum likelihood learning , which can be solved by gradient descent .
∑ [
∑
]
. ( 8 )
,
4.3 Spatial Classifier : SC The spatial classifier infers the AQI of a grid , using its own geospatial features and that of some grids having a monitor station . As depicted in Figure 13 , the SC consists of two parts : input generation ( in the left box ) and an artificial neural network , where , , and denotes the POI features , road network features , location , and the AQI label of grid k ; is the grid to be inferred ; is a distance function between features ( eg , we use the Pearson correlation in the experiments ) and calculates the geodistance between the center of two grids , eg ,
, ( 9 )
, ( 10 )
. ( 11 )
Input generation : In this phase , we randomly choose grids with labels , , to pair with the grid to be inferred ( we found =3 achieves the best inference accuracy in the experiments ) . The input of the ANN is then calculated according to Equation 9 to 11 . To learn the impact of different scales of distance between grids , we perform this pairwise process times to formulate a collection of inputs . The labeled grids involved in each round of input formulation should have at least different grids from existing ones , formally defined as : , , eg , =2 and =3 means at least one out of the three grids is different from those used previously . Another reason for doing so is to vary the input . As the POI and road network features extracted from a grid are static , the input ( , , ) do not change over if we always select the same three grids . Accordingly , the three inputs will be neglected by the ANN model in the training process .
Figure 13 . Structure of spatial classifier
Artificial neural network : Though many ANNs can be applied to our framework , we choose the widely used Back propagation ( BP ) neural network with one hidden layer in the experiments for its simplicity and generality . We set a linear function for the neurons ( each of which accepts all the features ) in the input layer and a sigmoid function for those in the hidden and output layers , formally defined as follows : ( ∑ ( ∑ ) ) ) , ( 12 ) where is a feature of input ; , , and are the biases associated with the neuron in different layers ; , , and denote the weight associated with the input of different layers .
( ∑
In the inference process , we also pair a grid to be inferred with a certain sets of labeled grids , generating a prediction of AQI label for each set . The frequency of each inferred label is then used as the probability score of the label , and the most frequent label will be selected as the final prediction result . The prediction of the SC can actually be regarded as a non linear interpolation over geo spaces , considering the road network and POIs of these
Yt 1Fm(t 1)t 1Ft(t 1)Fh(t 1)Fm(t)tFt(t)Fh(t)Fm(t+1)t+1Ft(t+1)Fh(t+1)YtYt 1∆P1x∆R1x cD1FpFrl1D2 cd1xD1D2D1D111FpFrlkkkFpxFrxlx∆Pkx∆Rkx cdkx1kxANNInput generationw'11w'qrw1wrwpqw11b1bqb'rb'1b''1441 locations . This classifier is effective as road network and POI data are good supplementary of traffic data .
5 . EXPERIMENTS 5.1 Datasets In the evaluation we use the following five real datasets detailed in Table 4 , where the first four sources are available in Beijing and Shanghai .
1 ) Meteorological data : We collect fine grained meteorological data , consisting of weather , temperature , humidity , barometer pressure , wind strength , from a public website every hour .
2 ) Air quality records : We collect both real valued and labeled AQI of four kinds of air pollutants , consisting of SO2 , NO2 , PM2.5 , and PM10 , reported by ground based air quality monitor stations in the four cities every hour . As a station may not have reports sometimes , we present the hours of effective records in Table 4 . 3 ) POIs : We employ a POI database from Bing Maps to extract for each city . The data of the first and third quarters of 2012 are used to identify the number of POIs changed in the five categories defined in Section 342 Figure 14 shows the POI distributions of Beijing and Shanghai .
Figure 14 . Number of POIs in different categories
4 ) Road networks : The road network data is also from Bing Maps .
5 ) Taxi trajectories : We use a GPS trajectory dataset generated by over 32,000 taxicabs in Beijing from August 21 to Nov . 30 , 2012 to calculate and . GPS equipped taxis can be regarded as mobile sensors probing the travel speed on roads , and the data also tell the pick up and drop off points of each trip . The total distance of the dataset is over 495 million kilometers , and the number of points reaches 1.45 billion . We found over 32 million occupied trips . As taxis generate about 20 percent of traffic flow on road surfaces of Beijing [ 14 ] , the dataset is big enough to represent the traffic patterns there . Of course , the features can be extracted from other data sources or a combination of multiple datasets , like mobile phone signal .
∑
∑
, ( 13 ) where denotes the geo distance between the location and the th monitor station .
2 ) Another interpolation method is based on a Gaussian distribution ( Gaussian ) , where is the average distance between any two existing air quality monitor stations in a city . Formally defined as
∑
, ( 14 )
√
. ( 15 )
We use continuous values in the interpolation and then discretize the aggregated result into AQI labels for evaluation .
3 ) Classical Dispersion Model ( Classical ) : This is a simple ( also well known ) mathematical model that is typically applied to point source emitters , simulating them as point or line emission source propagating as a Gaussian plume . We use a widely used tool CALPUFF [ 10 ] with default values for the parameters ( as these parameters , eg , vehicle emission rates , are difficult to obtain ) .
4 ) Decision tree ( DT ) : We choose this baseline to answer people ’s question why not just use a simple supervised learning model . In this baseline , we feed all the features equally into a decision tree .
5 ) CRF ALL and ANN ALL : Instead of dividing the features into two sets , the two baselines feed all features equally into the SC and TC respectively . We choose them as baselines to justify the features are used effectively in our approach .
Ground Truth : We deliberately remove a station from a grid and infer its air quality with the AQIs from other stations . The actual AQI reported by the station is then used as the ground truth to measure the inference . Each grid with a station is tested in this way every hour . For example , Beijing has 22 stations , generating 528 ( 22 24 ) test instances per day and 3,696 instances per week . In addition , we separate the training data from the test data by time , guaranteeing they have no overlap . Moreover , we apply the model trained in Beijing to the other cities , further verifying its effectiveness and adaptability to different cities .
5.3 Results Evaluation on Features : We first justify the effectiveness of the features , using the data shown in Table 5 , where a DT model is employed to study the performance of individual features and their combinations . Clearly , adding one feature set into the model brings a significant improvement on both precision and recall .
Table 4 . Details of the datasets
Table 5 . Results related to features
POIs
Roads
AQIs
Data sources 2012 Q1 2012 Q3 #.Segments Highways Roads # . Intersections # . Stations Hours Time spans
Urban Sizes ( grids )
Beijing 271,634 272,109 162,246 1,497km 18,525km
49,981
22
23,300
Shanghai 321,529 317,829 171,191 1,963km 25,530km
70,293
10
8,588
8/24/2012 3/8/2013 50 50km ( 2500 )
1/19/2013 3/8/2013 50 50km ( 2500 )
5.2 Baselines and Ground Truth We compare our method ( U Air ) with five baselines :
1 ) Linear interpolation ( Linear ) : This is a distance weighted interpolation algorithm using the AQI values reported by existing monitor stations , as shown in Equation 11 ,
Features
+ +
+ + +
+ + + +
PM10
NO2
Precision Recall Precision Recall 0.454 0.35 0.483 0.354
0.477 0.371 0.411 0.307
0.634 0.701
0.723
0.635 0.691
0.704
0.572 0.341 0.327 0.441 0.664 0.731 0.773
0.514 0.36 0.364 0.443 0.675 0.734 0.754
Overall Results : Figure 15 shows the performance of U Air and the five aforementioned baselines , where U Air outperforms other methods in terms of the mean precision and mean recall over time of day . The results demonstrate the advantage of our method over linear and Gaussian interpolations , and classical air pollutant dispersion models ( though latter may have a better performance with all the parameters accurately obtained , getting such parameters could be even difficult than building the model ) . the
C1C2C3C4C5C6C7C8C9C10C11C1205000100001500020000250003000035000C1 : Vehicle Services C2 : Transportation spots C3 : Factories C4 : Decoration/furniture markets C5 : Food and beverage C6 : Shopping malls and Supermarkets C7 : Sports C8 : Parks C9 : Culture & education C10 : Entertainment C11:Companies C12:Hotels and real estatesNum . of POIs Beijing Q3 Shanghai Q3 Beijing Q1 Shanghai Q11442 Additionally , simply using some supervised machine learning models ( like DT and CRF ) or ANN is less effective than the cotraining based approach .
Figure 15 . Overall results of different methods for PM10 and NO2
Results of Co Training : Figure 16 further reveals the co training progress of our approach , where we add an instance into the training data if SC or TC predicts it as a class with a probability score over 0.85 ( ie , very confidently inferred ) . The unlabeled data gradually improves the inference performance , justifying the ability of the co training framework in dealing with data sparsity .
Figure 16 . Learning progress of Co training
Table 6 shows the confusion matrix of U Air in inferring PM10 in Beijing ( we do not show other pollutants given the limited spaces ) .
Table 6 . Confusion matrix of U Air on PM10
Ground Truth
G M S U
Predictions S M 102 402 204 3614 200 532 70 22
G
3789 602 41 0
U 0 0 50 219
0.883 0.818 0.646 0.704 l l a c e R
0.855 0.853 0.586 0.814
0.828
Precision
Results of SC : To further study the ability of our approach in differentiating between more AQI labels , we solely test the spatial classifier ( no traffic related features needed ) . Note that this is the result of SC rather than co training . We use a half of the data for training and the rest for testing , ensuring both parts of data have a relatively balanced distribution over different AQI labels . Unbalanced data will result in impractically high accuracy in the test . We also apply the spatial classifier ( trained based on Beijing data ) to Shanghai data . As depicted in Figure 17 A ) , our SC has almost the same performance as that of Beijing , justifying its ability adapting to different urban environments . As shown in Figure 17 B ) , pairing a location with three stations in the SC generates a better result than using other number of stations ( eg , 2 or 4 ) .
Table 7 Confusion matrix of the Spatial Classifier
Ground Truth
G M U S U
V U & H
G 656 81 1 0 0 0.889 99
M 141 594 90 0 0
0.720
Predictions
U S 3 114 278 41 0
U 0 11 183 488 2
0.713
0.638 Precision
V U&H
0 0 23 43 190 0.742
0.820 0.743 0.483 0.853 0.989
0.751 l l a c e R than only using
Results of TC : Figure 18 presents the performance of our TC respectively using temporally related features and all features to infer PM10 in Beijing , showing two discoveries . First , feeding all features into the TC does not help , in most cases , becoming even worse the performances of two times slots ( around 8am and 6pm ) are higher than others . The two time slots actually correspond to the morning and evening rush hours of Beijing , in which traffic flows would be the major cause of air pollutants . Another reason is we also have enough number of taxi trajectories representing the traffic flow in the two slots ( ie , people travel a lot by taxis ) . temporal features . Second ,
Figure 17 . Study on the spatial classifier
Figure 18 . Study on TC using Beijing data ( PM10 )
Efficiency : Table 8 presents the online efficiency of our approach , which was tested on a 64 bit server with a Quad Core 2.67G CPU and 16GB RAM . On average , we can infer the air quality of a grid in 131ms , generating the AQIs for entire Beijing in 5 minutes .
Table 8 . Efficiency study
Procedures
Time(ms )
Procedures
Time(ms )
Feature extraction ( per grid )
&
53.2 28.8 14.4
Inference ( per grid )
SC TC
Total
21.5 13.1 131
Visualization : We infer the AQI of each location in the urban areas of Beijing and Shanghai by using our approach , coming up with two visualizations shown in Figure 19 A ) and B ) , where green and red grids respectively denote the top 100 locations that could have the best and worst AQIs in the two cities during the corresponding periods . The visualization can benefit air pollution analytics by identifying the locations always having a bad AQI .
Figure 19 . Top 100 locations with the best and worst AQIs
6 . RELATED WORK 6.1 Classical Bottom up Emission Models There are two major ways calculating the air quality of a location using the emission observed at ground surfaces , called “ bottom up ” methods . One is interpolation using the reports from nearby air
Precision PM10Recall PM10Precision NO2Recall NO2000102030405060708 U Air Linear Guassian Classical DT CRF ALL ANN ALL020406080100120140160065070075080PrecisionNum of Iterations SC TC Co Training020406080100120140160065070075080RecallNum of Iterations SC TC Co Training234567070071072073074075076Num of Stations Precision PM10 Recall PM10BeijingShanghai000102030405060708 PM10 Precision PM10 Recall NO2 Precision NO2 RecallA ) Results of different citiesB ) Results wrt number of stations04812162024045050055060065070075PrecisionTime of Day Temporal Features All features04812162024045050055060065070075080RecallTime of Day Temporal Features All featuresA ) Beijing B ) Shanghai1443 quality monitor stations . The method is usually employed by public websites releasing AQIs . As air quality varies in locations non linearly , the inference accuracy is quite low ( see Figure 15 ) .
The other is classical dispersion models , such as Gaussian Plume models , Operational Street Canyon models , and Computational Fluid Dynamics . These models are in most cases a function of meteorology , street geometry , receptor locations , traffic volumes , and emission factors ( eg , g/km per single vehicle ) , based on a number of empirical assumptions and parameters that might not be applicable to all urban environments [ 9 ] . For example , Gaussian Plume model requires vehicle emission rates ( eg , g/km per hour ) as input and assumes that the concentration is dispersed in the vertical and horizontal directions in a Gaussian manner . Some models may even require the height , length , and orientation of a street canyon , the gaps between buildings , as well as the roughness coefficient of the urban surface . As these parameters are difficult to obtain precisely , the results generated by such kinds of models may not be very accurate either . Compared with these models , our approach does not need empirical assumptions and parameters . Therefore , it is easy to conduct and applicable to different city environments . 6.2 Satellite Remote Sensing Satellite remote sensing of surface air quality has been studied intensively in past decades [ 7 ] , which can be regarded as topdown methods . For example , [ 1 ] compared PM2.5 inferred from the moderate resolution imaging spectroradiameter ( MODIS ) with surface PM2.5 measurements in Canada and the United States . Likewise , [ 6 ] estimated surface NO2 concentrations by applying local scaling factors from a global three dimensional model to tropospheric NO2 columns retrieved from the Ozone Monitoring Instrument onboard the Aura satellite . However , this category of methods is extremely influenced by clouds and would be sensitive to other factors , such as humidity , temperature , and location [ 1 ] . In addition , the results inferred from Satellite images only reflect the air quality of atmosphere rather than the ground air quality that people care more about . 6.3 Crowd Sensing Crowdsourcing or participatory sensing [ 2][3 ] may be a potential solution solving this problem in the future , if every person can carry a gas sensor equipped smart phone to probe the air quality around them . While this approach is feasible for some gasses like CO2 , it is not practical for other air pollutants like PM2.5 and NO2 so far as the devices for sensing such kinds of air pollutants are not easily portable ( refer to Figure 1 ) . In addition , the devices need a long period of sensing time ( eg , 1 hour ) before generating accurate results . 6.4 Urban Computing A series of research on urban computing has been done recently , using big data to tackle the big challenges in big cities . For instance , Jing et al . inferred the functional regions in a city using human mobility data and POIs [ 11 ] . Zheng et al . detected the underlying problems in a city ’s transportation network using taxi trajectories [ 14 ] . Zhang et al . sense the urban refueling behavior based on GPS equipped vehicles [ 15 ] . The research reported in this paper is also a step towards urban computing .
7 . CONCLUSION In this paper , from the perspective of big data , we infer the finegranularity air quality in a city based on the AQIs reported by a few air quality monitor stations and four datasets ( meteorological data , taxi trajectories , road networks , and POIs ) observed in the city . We identify five sets of features ( , , , , and ) based on the datasets and propose a co training based semisupervised learning approach consisting of a spatial classifier and a temporal classifier . We first evaluated our co training based approach using the data obtained in Beijing , resulting in an overall ( Precision=0.828 , Recall=0.826 ) for PM10 and ( Precision=0.808 , Recall=0.798 ) for NO2 . The results outperform that of linear interpolation , a classical dispersion model , and some well known supervised learning models like Decision Tree and CRF . Solely applying all features to the SC or TC is worse than our cotraining based approach . We applied the SC learnt from Beijing data to Shanghai , obtaining a result as good as that generated in Beijing ( about 076 ) These results demonstrate our approach is applicable to different city environments and seasons .
The key experiences we learned from the research lies in three aspects . First , features should be selected carefully from the data and used properly in the inference models . Second , the design of SC and TC is helpful as they respectively model the temporal dependency of air quality in a location and the spatial correlation between locations . Third , the co training based framework does a good job of addressing the data sparsity problem by leveraging the unlabeled data and the mutual reinforcement relationship between the two feature sets ( eg , POIs and road networks are good complementary of traffic related features ) . In the future , we would like to apply our approach to more cities and study the root causes of air pollution . 8 . REFERENCES [ 1 ] A . V . Donkelaar , R . V . Martin , and R . J . Park ( 2006 ) , Estimating ground level PM2.5 using aerosol optical depth determined from satellite remote sensing , J . Geophys . Res . , 111 , D21201 . [ 2 ] D . Hasenfratz , O . Saukh , S . Sturzenegger , and L . Thiele .
Participatory Air Pollution Monitoring Using Smartphones . In the 2nd International Workshop on Mobile Sensing .
[ 3 ] Y . Jiang , K . Li , L . Tian , R . Piedrahita , X . Yun , O . Mansata , Q . Lv , R .
P . Dick , M . Hannigan , and L . Shang . Maqs : A personalized mobile sensing system for indoor air quality . In Proc . of UbiComp 2011 . [ 4 ] J . Lafferty , A . McCallum , F . Pereira ( 2001 ) . Conditional random fields : Probabilistic models for segmenting and labeling sequence data . In Proc . of 18th International Conf . on Machine Learning .
[ 5 ] S . Ma , Y . Zheng , O . Wolfson . T Share : A Large Scale Dynamic Taxi
Ridesharing Service . In Proc . of ICDE 2013 .
[ 6 ] L . N . Lamsal , R . V . Martin , A . V . Donkelaar , M . Steinbacher , E . A .
Celarier , E . Bucsela , E . J . Dunlea , and J . P . Pinto ( 2008 ) , Groundlevel nitrogen dioxide concentrations inferred from the satellite borne Ozone Monitoring Instrument , J . Geophys . Res . , 113 , D1630 .
[ 7 ] R . V . Martin . Satellite remote sensing of surface air quality ,
Atmospheric Environment ( 2008 ) , doi:101016
[ 8 ] K . Nigam , R . Ghani . Analyzing the Effectiveness and Applicability of Co Training . In Proc . of CIKM 2000 .
[ 9 ] S . Vardoulakis , B . E . A . Fisher , K . Pericleous , N . Gonzalez Flesca .
Modelling air quality in street canyons : a review . Atmospheric Environment 37 ( 2003 ) 155 182 .
[ 10 ] JS Scire , DG Strimaitis and RJ Yamartino , 2000b : User ’s Guide for the CALPUFF Dispersion Model , ( Version 5.0 ) , Earth Tech , Inc . [ 11 ] J . Yuan , Y . Zheng , X . Xie . Discovering regions of different functions in a city using human mobility and POIs . In Proc . of KDD 2012 .
[ 12 ] J . Yuan , Y . Zheng , C . Zhang , X . Xie , G . Sun . An Interactive Voting based Map Matching Algorithm . In Proc . of MDM 2010 .
[ 13 ] J . Yuan , Y . Zheng , X . Xie , G . Sun . Driving with Knowledge from the
Physical World . In Proc . of KDD 2011 .
[ 14 ] Y . Zheng , Y . Liu , J . Yuan , X . Xie . Urban Computing with Taxicabs .
In Proc . of UbiComp 2011 .
[ 15 ] F . Zhang , D . Wilkie , Y . Zheng , X . Xie . Sensing the Pulse of Urban
Refueling Behavior . In Proc . of UbiComp 2013 .
1444
