Network A/B Testing : From Sampling to Estimation
Huan Gui† Ya Xu‡ Anmol Bhasin‡
Jiawei Han†
† University of Illinois at Urbana Champaign , Urbana , IL 61801 USA
‡ LinkedIn Corporation , Mountain View , CA 94043 USA
†{huangui2 , hanj}@illinois.edu ‡{yaxu , abhasin}@linkedin.com
ABSTRACT A/B testing , also known as bucket testing , split testing , or controlled experiment , is a standard way to evaluate user engagement or satisfaction from a new service , feature , or product . It is widely used in online websites , including social network sites such as Facebook , LinkedIn , and Twitter to make data driven decisions . The goal of A/B testing is to estimate the treatment effect of a new change , which becomes intricate when users are interacting , ie , the treatment effect of a user may spill over to other users via underlying social connections.When conducting these online controlled experiments , it is a common practice to make the Stable Unit Treatment Value Assumption ( SUTVA ) that each individual ’s response is affected by their own treatment only . Though this assumption simplifies the estimation of treatment effect , it does not hold when network interference is present , and may even lead to wrong conclusion .
In this paper , we study the problem of network A/B testing in real networks , which have substantially different characteristics from the simulated random networks studied in previous works . We first examine the existence of network effect in a recent online experiment conducted at LinkedIn ; Secondly , we propose an efficient and effective estimator for Average Treatment Effect ( ATE ) considering the interference between users in real online experiments ; Finally , we apply our method in both simulations and a real world online experiment . The simulation results show that our estimator achieves better performance with respect to both bias and variance reduction . The real world online experiment not only demonstrates that large scale network A/B test is feasible but also further validates many of our observations in the simulation studies .
Categories and Subject Descriptors G.3 [ Probability and Statistics ] : Experimental design
Copyright is held by the International World Wide Web Conference Committee ( IW3C2 ) . IW3C2 reserves the right to provide a hyperlink to the author ’s site if the Material is used in electronic media . WWW 2015 , May 18–22 , 2015 , Florence , Italy . ACM 978 1 4503 3469 3/15/05 . http://dxdoiorg/101145/27362772741081
1
Keywords A/B testing , controlled experiments , network A/ B testing , design of experiments , peer effects , network effects , balanced graph partition .
1 .
INTRODUCTION
A/B testing , also called controlled experimentation , is widely used in many consumer facing web technology companies to guide product development and data driven decisions , including Amazon , eBay , Etsy , Facebook , Google , Groupon , LinkedIn , Microsoft , Netflix and Yahoo . It has become the gold standard for testing out new product strategies and approaches [ 14 , 13 ] .
The theory of A/B test is simple and dates back to Sir Ronald A . Fisher ’s experiments at the Rothamsted Agricultural Experimental Station in England in the 1920s [ 29 ] . Rubin causal model [ 23 ] , a standard machinery of testing framework , is usually adopted in conducting and analyzing A/B tests . A key assumption made in Rubin causal model is the Stable Unit Treatment Value Assumption ( SUTVA ) , which states that the behavior of each user in the experiment depends only on their own treatment and not on the treatments of others .
However , in a social network setting , a user ’s behavior is likely impacted by that of his/her social neighborhood [ 12 , 27 , 28 ] . In most cases , a user would find a new feature more valuable and hence more likely to adopt it if more of his/her neighbors adopt it . For example , video chat is a useless feature unless one ’s friends use it too . The phenomenon that an individual ’s behavior has a non trivial effect on her social neighborhood is called network effect , also known as social interactions , peer influence , or social interference [ 2 , 8 ] . In an A/B experiment , this implies that if the treatment has a significant impact on a user , the effect would spill over to his/her social circles , regardless whether his/her neighbors are in treatment or control .
To understand how network effect introduces challenges for A/B testing , consider the Average Treatment Effect ( ATE ) , a primary quantity of interest defined as the difference of the average outcomes between applying treatment to the entire user population and applying control to the entire user population . Define U as the set of users and |U| = N , where N is the total number of users . Let Z ∈ M N , a vector of length N , as the experiment assignment vector for all users , where M is the set of variants . Without loss of generality , for the rest of the paper , we assume the experiment only has two variants , so M = {0 , 1} , where 1 stands for treatment and 0 for control . We let Yi(Z = z ) be the re sponse function of user i given Z = z . The response can be any user metrics the experiment tries to optimize , such as number of pageviews or clicks . The ATE can be expressed as
δ(1 , 0 ) =
1 N
E[Yi(Z = 1 ) − Yi(Z = 0) ] ,
( 1 ) i where 1 , and 0 are the treatment assignment where all users receive the control variant and treatment variant respectively .
Of course , a user can only receive one treatment at a time in reality . So in classical A/B experiments , we randomly select N0 users to receive the control variant , and N1 users to receive treatment . The ATE can then be estimated by
ˆδ =
1 N1
{i;zi=1}
Yi(Z = z ) − 1 N0
Yi(Z = z ) ,
( 2 )
{i;zi=0} where zi is the experiment assignment of user i . Under SUTVA and the Law of Large Numbers [ 11 ] , we have ˆδ → δ(1 , 0 ) when N1 , N0 → ∞ . However , when there is network effect , STUVA is no longer valid , and the convergence does not hold any more .
This poses a special challenge for running A/B tests in many online social and professional networks like Facebook , Twitter and LinkedIn . Many features tested there through A/B experiments are likely to have network effects . For example , a better recommendation algorithm in treatment for the People You May Know module on LinkedIn encourages a user to send more invitations . However , users who receive such invitations can be in the control variant and when they visit LinkedIn to accept the invitation they may discover more people they know . If the primary metric of interest is the total number of invitations sent , we would see a positive gain in both the treatment and the control groups . The ATE estimated ignoring network effect would be biased and not fully capturing the benefit of the new algorithm . Such bias exists in testing almost any features that involve social interactions , which is truly ubiquitous in a social network environment .
In this paper , we define the problem of A/B testing when there is network effect as Network A/B Testing . Specifically , we study the problem in large real social networks , which have substantially different properties and characteristics than simulated random networks studied in previous works . Our work aims at bridging the gap among theoretical analysis on casual analysis in the Statistical literature , recent works on network bucket testing [ 3 , 8 , 28 ] , and realworld applications of online controlled experiments . Our main contributions are as follows :
1 . As far as we know , we are the first to extensively study the problem in real social networks .
2 . We propose a simple yet efficient network sampling algorithm that is able to overcome an important challenge presented in sampling real social networks .
3 . We propose a new estimation model that not only generalizes the existing methods , but also produces smaller bias and variance in our extensive simulation studies .
4 . We are the first to study how the overall traffic split between treatment and control impacts the performance of various ATE estimators .
2
5 . We run a large scale network A/B test with a real application at LinkedIn . The results from the experiment not only help us compare the various models but also further validate many of the observations from the simulation studies .
The rest of the paper is organized as follows . Related work is discussed in Section 2 . In Section 3 we take a close look at possible network effect in a recent A/B experiment conducted at LinkedIn to motivate our study . Section 4 is where we introduce our framework for network A/B testing and propose our new network sampling and estimation methods . Extensive simulations and online experimental results are included in Section 5 . Section 6 concludes our study , summarizing our approach and motivating future work in this area .
2 . RELATED WORK
In this section , we will introduce some related work on network A/B testing , mainly including two parts , interference analysis in Statistics , and network bucket testing in Computer Science .
There are two parts of related work on interference , one is based on group level interference analysis , where there is interference within each group , and no interference across groups [ 10 , 24 , 22 , 26 ] ; the other one is based on unit level interference analysis , where interference between any two units may be non trivial [ 2 , 8 , 16 , 27 , 28 ] . [ 22 ] explores methods of inverting distribution free randomization tests for Fisher ’s sharp null hypothesis based on group level interference analysis . [ 24 ] considers the potential bias for ATE estimation when SUTVA is assumed , and further defines several causal estimands including direct and indirect effects that might be identifiable . This work is further extended by [ 10 ] by defining direct , indirect , total and overall causal effects , and relationship between these estimands are established . Hudegens et al . [ 10 ] also propose unbiased estimators of the proposed estimands by a two stage randomization procedure experimental design that first perform randomization at the group level , then at the individual level within groups . [ 26 ] gives conservative variance estimators , and proposes a new framework of finite sample inference analysis and inverse probability weighting estimators considering interference .
Regarding arbitrary interference of known form between units , [ 2 ] proposes randomization based methods to estimate ATE , and further refines the estimator by covariance adjustment , besides analysis of conservative estimators of the ATE estimators . [ 16 ] explores the identification of users’ responses under different constraints and assumptions , considering that social interference will influence users’ behaviors . To quantify the causal effect of peer influence , [ 27 ] introduces new randomization based causal estimand of peer influence , by extending the potential responses with social interference . [ 28 , 8 ] focus on estimating the ATE in networks , in which a new randomization scheme is proposed , called graph clustering randomization . Extensive simulations are conducted on random networks . We further this work by studying the ATE estimation on real networks , which have drastically different topologies and structures .
Another line of research that is quite related to our work is network bucket testing [ 3 , 12 ] , in which the new feature will take effect only if some minimal number of treated users’ social neighbors are also in treatment . [ 3 ] proposes a walk based sampling method to generate the core set of users which are internally well connected while approximately uniform over the whole network . This work is generalized by [ 12 ] , which introduces a general framework for network A/B testing , which first generate the core set based on different algorithms , and then gives out the corresponding variance bound based on the core set generation function .
Our work takes both the sampling ( design ) and estimation ( analysis ) into consideration , by proposing a realistic sampling method that works well in real networks and a new estimation framework that generalizes the existing ones .
3 . NETWORK EFFECT IN REAL EXPERI
MENT
There is a line of research studying social interference , also known as information diffusion [ 6 , 9 , 21 ] . Whenever information can be propagated from a user to his/her social neighborhood , there is likely to be network effect . In particular , we are interested in studying how such information propagates between the treatment and control groups in an A/B test setting . With that in mind , we first take a close look at a real A/B experiment recently conducted at LinkedIn on homepage Feeds . By incorporating components that are specific to one ’s social neighborhood , we show using a linear model that there is significant network effect present in this experiment . 3.1 Feed Experiment
Feed is an important part of LinkedIn homepage experience . It provides users with stories that they may be interested in reading , updates from their network ( such as a job change ) , and more . One can click on a feed , or interact with it through social gestures such as “ like ” , “ comment ” or “ share ” .
The Feed team strives to surface the most relevant items to users by constantly testing new recommendation algorithms . One important evaluation criteria is whether the new algorithm has improved the total number of user interactions with the feeds . In a recent experiment , users are randomly split into two equal groups , one receives the production algorithm ( control ) and the other receives a new experimental algorithm ( treatment ) that is supposed to provide more relevant feeds .
Because the sampling is uniformly random , users in treatment have neighbors in both treatment and control . Therefore , users in the control group will not only receive the set of recommended feeds from the control recommendation algorithm , but also the set of feeds shared/liked from their neighbors in treatment group , and vice versa . If the new algorithm is indeed better , and users are interacting more with the more relevant content discovered in their feeds , those good content pieces will leak into the control group and hence makes the control algorithm look better that it actually is .
In the following section , we will show that such concerns of information “ leaking ” is not vacuous and there is indeed significant network effect present in this feed experiment . We verify by extending the classical framework used to estimate ATE to incorporate components that are specific to one ’s social neighborhood .
3.2 Presence of Network Effect
Two sample t test is the most commonly used framework to analyze online experiment [ 7 ] . Suppose we are interested in some response metric Y ( eg pageviews per user ) . The null hypothesis is that treatment and control have the same mean for this metric ( ie ATE = 0 ) and the alternative is that they do not . The t test is based on the t statistic
ˆδ var
ˆδ ,
( 3 ) and under SUTVA , ˆδ defined in ( 2 ) is an unbiased estimator of the ATE and the t statistic is a normalized version of that estimator . This framework is in fact equivalent to the following linear model
( 4 ) where Zi ∈ {0 , 1} is user i ’s experiment assignment and the least square estimator for β turns out to be ˆδ .
Yi(Z ) = α + βZi
In order to take into consideration of possible network effect , we introduce two additional components to the linear model above , social interference and homophily [ 15 , 17 ] . The social interference component aims at capturing the “ spillover ” treatment effects from one ’s neighbors , and is therefore modeled based on the total number of treated neighbors , ie , A ·i Z , where A is the adjacency matrix , and A·i is the ith column of A . The homophily refers to the observation that one ’s social network is homogeneous considering different sociodemographic , behavioral , and intrapersonal traits , ie , people are more likely to connect with others who are similar ( birds of a feather ) . To this end , a user ’s behavior can be partially explained by the behavior of his/her neighbors . Therefore , homophily is approximated by the average behavior of i ’s neighborhood , ie , A ·i Y /Dii , where D is the j=1 Aij . Putting the three diagonal matrix that Dii = N pieces together , we have
Yi(Z ) = α + βZi + γA
·i Z + ηA
·i Y /Dii .
( 5 )
Note that linear additive models have been widely used in other works on causal analysis [ 15 , 27 ] . The three parameters β , γ and η aim at capturing treatment effect , network effect and homophily respectively . Under this simple linear model , we can estimate the size of each effect and test whether each effect is statistically significant . The results are shown in Table 1 where we can see that users’ responses are positively correlated with treatment effect ( primary effect ) , network effect , and homophily .
Metric
β
γ
η
# of interactions
0.0486
0.1252
0.0626
Table 1 : The linear regression results of the feed experiment . All the p value are < e−16 , and thus omitted .
It is important to point out that this experiment is conducted with fully uniform random sampling , and hence the number of treated neighbors and the neighborhood size are highly correlated . This means that the network effect we measure here could be confounded with one ’s popularity in the network . To control for that , we have also tried a model
3 that includes one ’s neighborhood size as the fourth component , as follows :
Yi(Z ) = α + βZi + γA
·i Z + ηA
·i Y /Dii + φDii .
The coefficient γ for the network effect stays significantly positive . Also note that because the sampling is done uniformly random , every user in the experiment has about the same percentage of neighbors in treatment . This means that we cannot expect to remove such confounding effect by using the percent of treated neighbors instead of the absolute number .
4 . NETWORK A/B TEST
The framework of A/B testing usually involves two parts : sampling , which determines who gets what treatment ; and estimation , which provides a framework to compute the ATE .
Uniform random sampling is the most commonly used sampling method in most web facing applications . It is simple and sufficient in most cases when the sample size is large . However , as we have mentioned in the last section , uniform random sampling makes it difficult to separate out the contribution of the network effect from other confounding factors such as neighborhood size . To this end , we look for a sampling solution in Section 4.1 that is able to take into consideration the network structure . The idea is to remove information diffusion between treatment and control groups as much as we can . However , as we will see , network sampling itself poses special challenges in real social networks because of their sizes and structures . We propose a sampling method that is able to overcome several of these challenges in Section 412 With the new sampling algorithm , we then study the problem of estimation , where we propose an exposure model and the corresponding estimators in Section 4.2 and show that they are a generalization of the existing estimators . 4.1 Network Sampling
Sampling is the process where we decide which users get assigned into what variant . At a high level , we try to split users into treatment and control so that there is as little information flow between the variants as possible . The sampling scheme we adopt here is called cluster randomized sampling , which is a sampling method where clusters of users are randomized together [ 18 , 20 ] . It is a two stage procedure :
1 . Partition the users into clusters ;
2 . Treat each cluster as a unit and randomize at the cluster level , so that all the users in the same cluster are assigned to the same variant .
The advantages of cluster randomized sampling include the ability to study the interference within the same cluster and the ability to control for “ contamination ” across clusters [ 8 ] . In this section , we will start with a recent proposal called net [ 28 ] . We examine its performance in a real social network . We then propose a new sampling algorithm that can overcome an important limitation and hence reduce the bias of the ATE estimator .
411 Graph Cluster Randomization Graph clustering , also known as community detection , graph cutting , and graph partition , is a well researched area [ 1 , 4 , 19 ] . However , clustering real social networks is challenging due to their special structure and topology . [ 28 ] proposes a local clustering algorithm , net , that overcomes some of those challenges and the idea is as follows :
1 . Find k cluster centers that are at least 2 − 1 apart ; 2 . Assign the nodes to their nearest center , and break the tie randomly if needed .
To study how this clustering algorithm works on real networks , we extract a sub network from LinkedIn ’s social graph by taking all the users who have ever worked at a leading internet technology company with a global presence . The sub network ( employee network ) is constructed by extracting the connections among them . After removing nodes with no connections , we get a network of about 70K users . The basic statistics of this sub network are given in Table 2 . We then apply the 3 net clustering algorithm to partition Nodes # Edges # max{di} mean {di} 7.26e4 var{di} 1.27e4
2.88e6
39.67
3997
Table 2 : Basic statistics of a employee network . this sub network into 100 shards . The distribution of the cluster sizes is given in Figure 1 .
Figure 1 : Cluster sizes of 3 net Network Clustering . Y axis specifies the log2 of cluster sizes .
It is not surprising to find out that the cluster sizes vary quite a lot . Intuitively , the net algorithm constructs clusters of radius at least − 1 around each center node , which implies that the size of each cluster is largely determined by the degrees of the center node . Because degrees are heterogeneous in real networks , so are the cluster sizes . But how would this influence the estimation of ATE ?
According to bias analysis in [ 18 ] , the ATE estimator given in ( 2 ) has the following bias
1 mt
Cov j∈J1 nj j∈J0 j∈J0 nj i=1 Yij nj
, j∈J1 j∈J0 i=1 Yij nj
, j∈J1 nj nj
( 6 )
( 7 )
E[ˆδ ] − δ = − M N
− 1 mc
Cov
4
020406080100Cluster Index0246810121416log(Cluster Size ) where J1 ( J0 ) is the set of clusters that are assigned to treatment ( control ) , Yij is the response of i th user in the j th cluster , nj is the size of cluster j , mt , mc are the size of J1 , J0 respectively , and Cov(·,· ) is the covariance function . To get an unbiased estimator , we need to have E[ˆδ]−δ = 0 , ie ,
Cov
Cov nj nj j∈J1 j∈J0 j∈J1 j∈J0 i=1 Yij nj i=1 Yij nj j∈J1 j∈J0
,
, nj
= 0 ,
( 8 ) nj
= 0 .
There are two scenarios under which ( 8 ) can hold . Scenario ( i ) : users’ responses Yij ’s are independent of cluster size nj ; Scenario ( ii ) : nj ’s are constant . When there is network effect , we expect users in larger treatment clusters to get more social influence , and hence scenario ( i ) is unlikely to hold . Therefore , we need a network sampling method that is able to produce equal size clusters . Based on this observation and the large scale of real online social networks , we propose a simple yet efficient balanced graph partition algorithm , called randomized balanced graph partition . 412 Randomized Balanced Graph Partition In this section , we introduce the randomized balanced graph partition algorithm with the goal of producing clusters that are of equal size and that can be computationally feasible to be applied to real , large scale social networks .
We start with an initial feasible partition where all the clusters are of the same size . Our goal is to maintain the balance of the cluster sizes while maximize the number of edges within each cluster . To do that , we iteratively update the cluster label of each node based on the majority vote from its neighbors . The balance of the cluster sizes is achieved by swapping the cluster label of a pair of nodes , instead of simply changing them . The challenge , of course , is to decide which and how many pairs of labels should be swapped .
It is worth noting that the balanced graph partitioning problem is proven to be NP complete even for the case with only two clusters [ 1 ] . We propose a greedy algorithm with randomization , which is effective and efficient and can be easily parallelizable . Our algorithm alternates the two steps below till convergence :
1 . Label Propagation . Define “ gain ” as an increase of the number of edges between nodes of the same cluster . For every pair of nodes , switch their cluster labels in a greedy way until the gain cannot be increased any more .
2 . Random Shuffling . Randomly select 5 % pairs of nodes , and swap their labels .
By randomly shuffling the cluster labels , we can break the local optimum , and increase the number of links within the same cluster . As shown in Table 3 , we can improve the baseline label propagation by 8.9 % with shuffling . Since the sub network is not very large , we are also able to compare our proposal with Modularity Maximization 1 [ 5 ] , which is
1The Modularity Maximization algorithm does not generate clusters with equal sizes , so that we constrained the maximum cluster size during each iteration .
Methods
LP
RSLP MM
# of links in clusters
2.161
2.355
2.359
Table 3 : Clustering results for Label Propagation ( LP ) and Random Shuffling on Label Propagation ( RSLP ) , as well as one based on Modularity Maximization ( MM ) . known to have good performance but computationally expensive for large networks . Our proposed method achieves comparable results yet is scalable . 4.2 Estimation
In this section , we study the problem of how to estimate ATE . To do that , we need to first decide how we model users’ exposure to network effects . As we will see , the assumptions of existing exposure models are hard to satisfy in real networks and under the new sampling scheme we proposed in Section 412
To address this problem , we propose a new exposure model that we describe in Section 424 and the corresponding estimators . Through a linear additive model , we are able to show that our exposure model and estimator is a generalization of the existing ones . 421 Framework Suppose z = ( z1 , z2,··· , zN ) where zi ∈ {0 , 1} , and the probability of seeing a particular value of z is pz . Let Ω = {z : pz > 0} , so that Z = ( Z1 , , ZN ) is a random vector with support Ω and probability P r(Z = z ) = pz . Define a unit specific onto function that maps an assignment vector and unit specific traits ξi ∈ Ξ ( such as one ’s local neighborhood structure ) to an expected user response f : Ω× Ξ → ∆ . The codomain of ∆ contains all the expected treatment responses that might be induced in the experiment .
Instead of being determined by the entire treatment assignment vector , users’ responses are determined by different treatment exposures , which are resulted from the interaction of sampling design ( Z ) and the traits of users ξi . The key step of causal inference , as well as treatment effect estimation , is to specify f .
The ATE can be expressed as fi(Z = 1 , ξi ) − 1 N fi(Z = 0 , ξi )
( 9 )
N i=1
N
1 N
δ = = τ1 − τ0 i=1 where τ1 is the expected response when treatment is applied globally , similarly for τ0 . We will start with two existing exposure models and their corresponding ATE estimators . 422 Under the Stable Unit Treatment Value Assumption , also
SUTVA known as Individual Treatment Response , f is defined as f S i ( Z , ξi ) = I(Zi = 1)τ1 + I(Zi = 0)τ0 .
( 10 )
In other words , ( i ) user i ’s treatment exposure depends only on his/her own treatment , regardless of the treatment assignments of other users in the network ; ( ii ) user i ’s expected response under treatment ( control ) is the same as if everyone were in treatment ( control ) . It is easy to see that under this response function f S , the ATE can be estimated based on ( 2 ) .
5
423 Neighborhood Exposure There are two basic Neighborhood Exposure models , one based on the percent of treated neighbors and the other based on the absolute number of treated neighbors . We assume the former in our discussion here as it is more robust to the heterogeneity of users’ degrees , though the analysis for the latter is similar . Given a threshold θ ∈ [ 0 , 1 ] , the expected response func tion f for the neighborhood exposure model is defined as i ( Z , ξi ) = I(Zi = 1 , σi ≥ θ)τ1 + I(Zi = 0 , σi ≤ 1 − θ)τ0 f N +(I(Zi = 0 , σi ≥ 1 − θ ) + I(Zi = 1 , σi ≤ θ))Xi(Z , ξi ) , where Xi(Z , ξi ) is an unknown function and σi is the percent of i ’s neighbors in treatment . Define T θ i = {Z|Zi = 1 , σi ≥ θ} . Then we have that ∀ Z ∈ T θ i , i is neighborhood exposed to treatment . Similarly , define Cθ i = {Z|Zi = 0 , σi ≤ 1 − θ} . We have that ∀ Z ∈ Cθ i , i is neighborhood exposed to control . Under the neighborhood exposure model , we have ( i ) user i ’s treatment exposure depends on not just his/her own treatment but also his/her neighbors’ treatment assignment ; ( ii ) user i ’s expected response when he/she is network exposed to treatment ( control ) is τ1 ( τ0 ) , the same as if everyone were in treatment ( control ) .
For i to be neighborhood exposed to treatment , i should be in treatment and at least θ fraction of i ’s neighbors are also in treatment . For users who are not neighborhood exposed to either treatment or control , their responses ( Xi(Z , ξi ) ) are considered invalid and are hence removed from estimation . Again , we can estimate τ1 and τ0 based on the sample means of the network exposed users and hence the ATE as
ˆδN =
1 N θ 1
Yi − 1 N θ 0 i;Z∈T θ i i;Z∈=Cθ i
Yi ,
( 11 ) where N θ exposed to control , treatment respectively .
1 are the number of users that are network
0 , N θ
A key step of applying Neighborhood Exposure model is to select θ , the threshold for σi that determines which nodes meet the condition of being neighborhood exposed . To see how θ affects the estimation , we first apply the randomized graph partition to the employee network in Table 2 . After randomly assigning 50 of the 100 clusters to treatment , we have an empirical cumulative distribution function of σi for the nodes in treatment ( Figure 2 ) .
By setting different θ ’s , we have the following observa tions .
• If we set θ = 0.9 , we have Pr(σi ≤ θ ) = 079 A larger θ means a weaker assumption for the exposure model and hence smaller bias . However , about 79 % observations are “ invalid ” and cannot be used to estimate the ATE , which leads to larger variance ;
• If we set θ = 0.3 , we have Pr(σi ≤ θ ) = 007 93 % of the observations can be used in the estimation . However , a smaller θ means a stronger assumption and hence a larger bias .
The bias and variance trade off presented in the choice of θ leads us to propose a new estimator that is able to take into consideration the level of exposure , and hence utilize all observations regardless whether they are network exposed . The new model also turns out to be a generalization of the exposure models and estimators discussed so far .
Figure 2 : Empirical cumulative distribution function of σi for nodes in treatment .
424 Fraction Neighborhood Exposure In this section , we propose a new estimator based on what we call the Fraction Neighborhood Exposure model . We define f the expected response function to be any function that depends only on the user ’s experiment assignment and the fraction of his treated neighbors σi : f F i ( Z , ξi ) = g(Zi , σi ) .
( 12 )
It is easy to see that the ATE in ( 9 ) becomes
δ = g(1 , 1 ) − g(0 , 0 ) .
( 13 ) Various response function g(· ) can be chosen to model users’ behavior . We demonstrate using two linear additive models .
Linear Additive Model I .
The first model we consider is as follows : g(Zi , σi ) = α + βZi + γσi ,
( 14 ) where β captures the treatment effect and γ the network effect . α , β , γ can be estimated from users’ responses , as ˆα , ˆβ , ˆγ . The additive assumption of various effects is also made by previous works , such as the “ linear in mean ” model [ 15 ] . By ( 13 ) , the ATE can be estimated as
ˆδLI = ˆβ + ˆγ .
Linear Additive Model II .
The linear model in ( 14 ) can be further generalized by considering different response functions for users in treatment and control groups : if Zi = 0 if Zi = 1
( 15 ) fl α0 + γ0σi ,
α1 + γ1σi , g(Zi , σi ) = where α0 , γ0 are learned from observation data of users in control group , while α1 , γ1 are learned from observation data of users in treatment group . By ( 13 ) , the ATE can be estimated as
ˆδLII = ˆα1 + ˆγ1 − ˆα0 .
6
425 Comparison of Exposure Models While comparing the three exposure models we discussed so far , we show in this section that the SUTVA and neighborhood exposure model are special cases of the fraction neighborhood exposure model .
Proposition 1 . SUTVA is a special case of fraction neighborhood exposure model in ( 14 ) .
Proof . It can be trivially proved by setting γ = 0 , ie , set the network effect to be zero .
For the case of neighborhood exposure model , we only need to show that the assumption of the response function is a special case of the linear model in ( 14 ) .
Proposition 2 . The neighborhood exposure model is a special case of the fraction neighborhood exposure model in ( 14 ) .
Proof . The response function in neighborhood exposure model can be defined as follows :
τ1 invalid
 τ0  α + βZi
α + βZi invalid f N i ( Z , ξi ) = which is equivalent to f N i ( Z , ξi ) = if Zi = 0 , σi < 1 − θ if Zi = 1 , σi > θ otherwise if Zi = 0 , σi < 1 − θ if Zi = 1 , σi > θ otherwise
, by re parameterizing α = τ0 , β = τ1 − τ0 . In other words , f N i ( Z , ξi ) = α + βZi restricted to only users who are network exposed .
5 . EXPERIMENTAL RESULTS
In order to demonstrate the effectiveness and efficiency of fraction neighborhood model , we performed various experiments including extensive simulations and a real online experiment . These two types of experiments are complementary . We can obtain ground truth in the simulation study , so it is possible to evaluate methods under various conditions based on their bias and variance . On the other hand , real experiment offers special insights into how models compare in practice . Also note that all simulations here are based on real social network , so we only need to simulate user responses . 5.1 Simulations
Considering the heterogeneity of degrees of nodes in real social networks , we will use the Randomized Balanced Graph Partition algorithm proposed in Section 412 to determine the experiment assignment and focus on comparing the estimation models . To be more specific , we aim at answering the following questions based on the simulations :
1 . How does the percentage of units under treatment ( or control ) influence the estimation ?
2 . How do different estimation models compare with re spect to both bias and variance ?
All simulations are based on the employee network summarized in Table 2 , which has a heterogeneous degree distribution with a high variance . We have also run similar simulation analysis on different networks extracted from LinkedIn ’s social network graph , but the results are similar .
Simulation Model
511 The observed user response is generated based on the fol lowing probit model [ 8]2
∗ i,t = λ0 + λ1Zi + λ2
Y
Yi,t = I(Y
∗ i,t > 0 ) ,
A
·i Yt−1 Dii
+ Ui,t
( 16 ) where Yi,t is the response of i at time t and Ui,t ∼ N ( 0 , 1 ) is a stochastic component capturing user specific traits . λ0 is the baseline and WLOG we set it to be −15 λ1 captures the strength of treatment effect , and λ2 is for the network effect . We initialize Yi,0 = 0 for all users , and then run the iterative process to generate users’ responses for T steps with different combinations of λ1 and λ2 where λ1 ∈ {0.25 , 0.5 , 0.75 , 1.0} , and λ2 ∈ {0 , 0.1 , 0.5 , 10} The step length is set to T = 3 . Note that in this data generation model , one ’s response depends directly on the behavior of his/her neighbors at the previous time stamp , not simply the neighbors’ experiment assignments , which is quite realistic .
512 Estimators We have discussed different estimators in Section 421 according to different exposure models . In addition to these discussed , we will also include in the comparison the Hajek estimator [ 2 ] . Specifically , we will study the following five estimators :
1 . Under SUTVA , the sample mean estimator as in ( 2 ) .
2 . Under the Neighborhood Exposure Model , the sample mean estimator as in ( 11 ) .
3 . Under the Neighborhood Exposure Model , the Hajek estimator [ 2 ] defined as follows
N N i=1 I(zi = 0 , σi < 1 − θ ) Yi π(Ci ) N i=1 I(zi = 0 , σi < 1 − θ ) π(Ci ) N i=1 I(zi = 1 , σi > θ ) Yi π(Ti ) i=1 I(zi = 1 , σi > θ ) π(Ti )
τ0,H = τ1,H = H =τ1,H −τ0,H
ˆδN
1
1
( 17 ) where π(Ci ) and π(Ti ) are the probabilities for i to be neighborhood exposed to control and treatment given the cluster level randomization .
4 . Under the Fraction Neighborhood Exposure Model , the linear model I estimator as in ( 14 ) .
5 . Under the Fraction Neighborhood Exposure Model , the linear model II estimator as in ( 15 ) .
We did 1000 simulations to compute both bias and variance for each of these estimators . For each simulation , the true ATE is estimated by putting all users in treatment or all in control .
2For fair comparison , the simulation process is exactly the same as [ 8 ] except that we use real networks while [ 8 ] uses simulated random networks .
7
513 Percentage of Users in Treatment When running an A/B test , how to split the traffic between treatment and control is one of the key questions one has to decide . This is even more crucial if there is network effect , as the overall percentage of users in treatment ( ρ ) will substantially influence the fraction of one ’s neighbors in treatment , which leads to different level of treatment exposure . This is demonstrated by how the empirical cumulative distribution function of σi changes with different ρ in Figure 3 .
Figure 3 : By changing the percentage of units in treatment ρ , the distribution of σi changes significantly .
+ 1 N1
N0
1
A more interesting question is how the performance of different estimators change with ρ . As far as we know , we are the first one to study this problem and the results are shown in Figure 4 . We have the following observations . ( i ) The bias of each estimator does not change much as ρ changes , but the variance changes significantly and reaches the smallest when ρ = 0.5 ( as expected since Var ∼ 1/ ) . ( ii ) For ρ < 0.3 and ρ > 0.7 , the variance of the Hajek estimator is large because the scale factors πi ’s ( probabilities of being neighborhood exposed ) are small . ( iii ) The Hajek estimator performs worse than sample mean estimator under the same neighborhood exposure model . It is interesting to note that , in random networks such difference is minimal [ 8 ] , showing the importance of the network structure when evaluating estimators . ( iv ) Our linear estimators under the Fraction Neighborhood Exposure model achieve the smallest bias and variance . The LI estimator achieves smaller variance , while LII estimator achieves smaller bias . The different between LI estimator and LII is minimal when ρ = 05
We have also studied the influence of the threshold θ for the two estimators under the neighborhood exposure model . As expected , a larger θ results in a smaller bias but a larger variance , as shown in Figure 5 .
514 Network Effect We now compare the performance of different ATE estimators under different levels of treatment effects and network effects , by changing the values of λ1 and λ2 in the simulation model ( 16 ) . We use ρ = 0.5 and the results are
8
( a ) The bias of different estimators
( b ) The variance of different estimators
Figure 4 : Behavior of different estimators with different percentage of neighbors in treatment . shown in Figure 6 . The results with ρ = 0.1 are similar and hence omitted .
We have the following observations . ( i ) The bias of both sample mean and Hajek estimators under the neighborhood exposure model becomes larger as the network effect and treatment effect become larger ; ( ii ) The variance of the estimators is fairly consistent across different levels of treatment effect and network effect . This is because the number of observations used in estimation does not change as λ1 and λ2 change . In addition , the linear estimators under our fraction neighborhood exposure model achieve a smaller variance than the estimators under the neighborhood exposure model because all the observations are included in the estimation . ( iii ) Our linear estimators achieve the best bias and variance across different levels of network effect and treatment effect .
000204060810θ000204060810Pr(σiθ)ρ=02ρ=05ρ=08010203040506070809percentage of units in treatment ( ρ)0040003500300025002000150010000500000005bias of ATE estimatorUniform , SUTVA , Sample MeanCluster , Neighborhood ( 0.75 ) , Sample MeanCluster , Neighborhood ( 0.75 ) , HajekCluster , Fraction , Sigma ( LI)Cluster , Fraction , Sigma ( LII)010203040506070809percentage of units in treatment ( ρ)01e 42e 43e 44e 4variance of ATE estimatorUniform , SUTVA , Sample MeanCluster , Neighborhood ( 0.75 ) , Sample MeanCluster , Neighborhood ( 0.75 ) , HajekCluster , Fraction , Sigma ( LI)Cluster , Fraction , Sigma ( LII ) Figure 5 : The bias of different estimators
5.2 Real Online Experiment
In addition to the extensive simulations , we have also conducted a real online experiment at LinkedIn using the network A/B testing framework we have proposed . Specifically , we have done the following :
1 . Select a country as the sub network to experiment on .
2 . Apply our randomized balanced graph partition algorithm to assign users from this country into treatment and control groups .
3 . Apply different Feed algorithms to the treatment and control groups . Estimate the ATE after running the experiment for two weeks .
Note that unlike simulations , we do not have ground truth for this real experiment . The Feed team has , however , compared these two Feed algorithms globally in a uniformly randomized A/B test , and the treatment Feed algorithm was significantly better than control .
Our goal for the real experiment is two fold . First , we would like to compare results from different estimators in a real application setting to complement the observations from simulations . In particular , we want to compare results with and without taking into consideration of the network effect , and further , how our fraction neighborhood exposure model compares with the neighborhood exposure model . Second , as far as we know , we are the first to run a real network A/B test . We would like to establish a process for running network A/B test in practice . As we have seen how the conclusions can differ drastically in real networks compared to simulated networks , we hope this can bridge the gap and encourage more research focusing on real applications in the area of network A/B testing .
521 Country Selection We would like to select a country that has a well selfcontained LinkedIn social network . Ideally , It should be an isolated sub network that has as few connections to the outside of the country as possible to prevent network influence to and from users outside . We use the following ratio to
( a ) The bias of different estimators
( b ) The variance of different estimators
Figure 6 : Behavior of different estimators with different percentage of neighbors in treatment with the overall percentage of nodes in treatment ρ = 05 quantify such “ self containment ” for a set S of users :
2 i∈S
RS = i,j∈S Ai,j
. j∈Sc Ai,j
In other words , it is the ratio between the edge count within the set S and the edge count from S to its compliment S c . We calculate RS for all countries on LinkedIn , and among the ones with top RS ratios ( shown in Table 4 ) , we decide to pick Netherlands as it has the highest average internal degrees and a reasonably large sized network ( around 6 million users ) .
After selecting the Netherlands as the sub network , we applied the randomized balanced graph partition algorithm to divide it into 600 shards and randomly picked 300 of them
9
0304050607percentage of units in treatment ( ρ)001400120010000800060004000200000002bias of ATE estimatorCluster , Neighborhood ( 0.65 ) , Sample MeanCluster , Neighborhood ( 0.75 ) , Sample MeanCluster , Neighborhood ( 0.85 ) , Sample MeanCluster , Neighborhood ( 0.65 ) , Hajek estimatorCluster , Neighborhood ( 0.75 ) , Hajek estimatorCluster , Neighborhood ( 0.85 ) , Hajek estimator025075025075025075025075treatment effect ( λ1)008006004002000002bias of ATE estimatornetwork effectλ2= 0.0network effectλ2= 0.1network effectλ2= 0.5network effectλ2= 1.0network effectλ2= 0.0network effectλ2= 0.1network effectλ2= 0.5network effectλ2= 1.0network effectλ2= 0.0network effectλ2= 0.1network effectλ2= 0.5network effectλ2= 1.0network effectλ2= 0.0network effectλ2= 0.1network effectλ2= 0.5network effectλ2= 1.0network effectλ2= 0.0network effectλ2= 0.1network effectλ2= 0.5network effectλ2= 1.0Uniform , SUTVA , Sample MeanCluster , Neighborhood ( 0.75 ) , Sample MeanCluster , Neighborhood ( 0.75 ) , HajekCluster , Fraction , Sigma ( L1)Cluster , Fraction , Sigma ( L2)025075025075025075025075treatment effect ( λ1)01e 52e 53e 54e 5variance of ATE estimatornetwork effectλ2= 0.0network effectλ2= 0.1network effectλ2= 0.5network effectλ2= 1.0network effectλ2= 0.0network effectλ2= 0.1network effectλ2= 0.5network effectλ2= 1.0network effectλ2= 0.0network effectλ2= 0.1network effectλ2= 0.5network effectλ2= 1.0network effectλ2= 0.0network effectλ2= 0.1network effectλ2= 0.5network effectλ2= 1.0network effectλ2= 0.0network effectλ2= 0.1network effectλ2= 0.5network effectλ2= 1.0Uniform , SUTVA , Sample MeanCluster , Neighborhood ( 0.75 ) , Sample MeanCluster , Neighborhood ( 0.75 ) , HajekCluster , Fraction , Sigma ( L1)Cluster , Fraction , Sigma ( L2 ) that is able to take into consideration of the level of network exposure . Extensive simulations are conducted to evaluate these methods and the results show that our new proposals can achieve both a smaller bias and a smaller variance . We have also conducted a real online experiment under the framework we have proposed and the results further validate many observations from simulations .
On the other hand , there are still many open problems in the field of network A/B testing that remain to be addressed , especially with respect to real world applications . First of all , we did not consider the influence strength between pairs of nodes , which may have significant impact on determining users exposure status ; Secondly , real social networks are growing all the time , leading to rapid change of network structures , which makes network A/B testing even more challenging considering the effect of newly added edges and nodes . To further complicate the problem , many real experiments on social networks are aiming at increasing network density , making the temporal variability a real , noticeable issue . Thirdly , there are different forms of network interference to be considered . For instance , in discussion groups , information propagates from one user to all other users of the same group , so every group acts as a fully connected sub network . However each user can belong to multiple groups . In this case , the graph clustering randomization can no longer split users into treatment and control under the new information propagation structure . Lastly , our focus here has been on ATE estimation , and we have not touched upon how virality works and how to preserve it in a network A/B testing setting . Given the complex structure of real social networks and the way viral information propagates , the framework proposed here may not be sufficient .
A/B testing in general is widely used and also well studied in the industry as it offers the best scientific approach to understand the causal impact of product changes on end user behavior . However , the problem of A/B testing in a social network setting is no where near solved . A lot of work still remains to be done to make it a well understood problem in real world applications . We hope our work here can bridge some of the gaps and encourage more research in this area .
Acknowledgement We wish to thank our colleagues and friends who have held many enlightening discussions with us : Deepak Agarwal , Mathieu Bastian , Evion Kim , Haishan Liu , Mitul Tiwari , Wayne Tai Lee and many members of the A/B testing team at LinkedIn . In addition , we wish to thank Bee Chung Chen , Liang Zhang , Pannagadatta Shivaswamy , Cory Hicks and Caroline Gaffney for working with us to run the network A/B test on LinkedIn Feeds .
Country
# Users ( M )
Ratio RS
Avg . Degree
Internal
Brazil
United States Netherlands
Chile
New Zealand
19.9 119.3 6.1 2.8 1.3
0.932 0.910 0.868 0.866 0.654
41.6 54.3 93.0 38.4 29.4
Table 4 : Basic statistics about several countries . to receive treatment while the rest 300 to receive control . Before performing the A/B test , we have also conducted an A/A test , which is a controlled experiment where treatment is identical to control . This was to confirm that no bias was introduced during the experiment assignment process . 522 Online Results We let the experiment run for two weeks before we collected data for analysis . The metric we use for evaluation is the average number of social gestures on Feed , such as “ like ” , “ comment ” or “ share ” .
We compute the ATE based on the various estimators described in Section 512 The results are shown in Table 5 . We have the following observations . ( i ) The ATE estimates with consideration of network effect are all larger than the estimate under SUTVA . This is yet another good confirmation that there is indeed network effect presented in the A/B experiment . ( ii ) The choice of θ in the neighborhood exposure model matters . The sample mean estimator almost doubles when θ changes from 0.75 to 09 On the other hand , the Hajek estimator gives a smaller estimate when θ changes from 0.75 to 0.9 , this is due to small values of πi ’s when θ is large . ( iv ) The fraction neighborhood exposure model gives larger estimates than existing methods .
Method SUTVA Neighbor . Exposure θ = 0.75 Neighbor . Exposure θ = 0.9 Hajek . Exposure θ = 0.75 Hajek . Exposure θ = 0.9 Fraction Exposure ( I ) Fraction Exposure ( II )
ATE for social gestures
0.168 0.264 0.520 0.625 0.133 0.687 0.714
Table 5 : ATE estimates from different models for the online Feed experiment .
6 . CONCLUSION AND FUTURE WORK
In this paper , we study the problem of network A/B testing in real networks . We start by examining a recent A/B experiment conducted on LinkedIn without considering network structures , which motivates us to set up a framework to study both the sampling and the estimation aspects of the network A/B testing problem . To address the challenge of degree heterogeneity in real social networks , we come up with a new randomization scheme based on balanced graph partitioning , for which an efficient and distributed algorithm is proposed . Based on new sampling scheme , we propose a new method to estimate the average treatment effect ( ATE )
10
References [ 1 ] K . Andreev and H . Racke . Balanced graph partitioning . Theory of Computing Systems , 39(6):929–939 , 2006 .
[ 2 ] P . M . Aronow and C . Samii . Estimating average causal effects under general interference . Citeseer , 2012 .
[ 3 ] L . Backstrom and J . Kleinberg . Network bucket testing . In Proceedings of the 20th international conference on World wide web , pages 615–624 . ACM , 2011 .
[ 4 ] D . A . Bader , H . Meyerhenke , P . Sanders , and
D . Wagner . Graph partitioning and graph clustering , volume 588 . American Mathematical Soc . , 2013 .
[ 5 ] V . D . Blondel , J L Guillaume , R . Lambiotte , and E . Lefebvre . Fast unfolding of communities in large networks . Journal of Statistical Mechanics : Theory and Experiment , 2008(10):P10008 , 2008 .
[ 6 ] J . Cheng , L . Adamic , P . A . Dow , J . M . Kleinberg , and
J . Leskovec . Can cascades be predicted ? In Proceedings of the 23rd international conference on World wide web , pages 925–936 . International World Wide Web Conferences Steering Committee , 2014 .
[ 7 ] N . Cressie and H . Whitford . How to use the two sample t test . Biometrical Journal , 28(2):131–148 , 1986 .
[ 8 ] D . Eckles , B . Karrer , and J . Ugander . Design and analysis of experiments in networks : Reducing bias from interference . arXiv preprint arXiv:1404.7530 , 2014 .
[ 9 ] H . Gui , Y . Sun , J . Han , and G . Brova . Modeling topic diffusion in multi relational bibliographic information networks . In Proceedings of the 23rd ACM International Conference on Conference on Information and Knowledge Management , pages 649–658 . ACM , 2014 .
[ 10 ] M . G . Hudgens and M . E . Halloran . Toward causal inference with interference . Journal of the American Statistical Association , 103(482 ) , 2008 .
[ 11 ] K . L . Judd . The law of large numbers with a continuum of iid random variables . Journal of Economic theory , 35(1):19–25 , 1985 .
[ 12 ] L . Katzir , E . Liberty , and O . Somekh . Framework and algorithms for network bucket testing . In Proceedings of the 21st international conference on World Wide Web , pages 1029–1036 . ACM , 2012 .
[ 13 ] R . Kohavi , A . Deng , B . Frasca , T . Walker , Y . Xu , and
N . Pohlmann . Online controlled experiments at large scale . In Proceedings of the 19th ACM SIGKDD international conference on Knowledge discovery and data mining , pages 1168–1176 . ACM , 2013 .
[ 14 ] R . Kohavi , A . Deng , R . Longbotham , and Y . Xu . Seven rules of thumb for web site experimenters . Proceedings of the 14th ACM SIGKDD international conference on Knowledge discovery and data mining , 2014 .
11
[ 15 ] C . F . Manski . Identification of endogenous social effects : The reflection problem . The review of economic studies , 60(3):531–542 , 1993 .
[ 16 ] C . F . Manski . Identification of treatment response with social interactions . The Econometrics Journal , 16(1):S1–S23 , 2013 .
[ 17 ] M . McPherson , L . Smith Lovin , and J . M . Cook . Birds of a feather : Homophily in social networks . Annual review of sociology , pages 415–444 , 2001 .
[ 18 ] J . A . Middleton and P . M . Aronow . Unbiased estimation of the average treatment effect in cluster randomized experiments . Available at SSRN 1803849 , 2011 .
[ 19 ] M . E . Newman . Modularity and community structure in networks . Proceedings of the National Academy of Sciences , 103(23):8577–8582 , 2006 .
[ 20 ] S . W . Raudenbush . Statistical analysis and optimal design for cluster randomized trials . Psychological Methods , 2(2):173 , 1997 .
[ 21 ] M . G . RODRIGUEZ , J . LESKOVEC , D . BALDUZZI , and B . SCH ¨OLKOPF . Uncovering the structure and temporal dynamics of information propagation . Network Science , 2(01):26–65 , 2014 .
[ 22 ] P . R . Rosenbaum . Interference between units in randomized experiments . Journal of the American Statistical Association , 102(477 ) , 2007 .
[ 23 ] D . B . Rubin . Estimating causal effects of treatments in randomized and nonrandomized studies . Journal of educational Psychology , 66(5):688 , 1974 .
[ 24 ] M . E . Sobel . What do randomized studies of housing mobility demonstrate ? causal inference in the face of interference . Journal of the American Statistical Association , 101(476):1398–1407 , 2006 .
[ 25 ] L . Tang , R . Rosales , A . Singh , and D . Agarwal .
Automatic ad format selection via contextual bandits . In Proceedings of the 22nd ACM international conference on Conference on information & knowledge management , pages 1587–1594 . ACM , 2013 .
[ 26 ] E . J . T . Tchetgen and T . J . VanderWeele . On causal inference in the presence of interference . Statistical Methods in Medical Research , 21(1):55–75 , 2012 .
[ 27 ] P . Toulis and E . Kao . Estimation of causal peer influence effects . In Proceedings of The 30th International Conference on Machine Learning , pages 1489–1497 , 2013 .
[ 28 ] J . Ugander , B . Karrer , L . Backstrom , and
J . Kleinberg . Graph cluster randomization : network exposure to multiple universes . In Proceedings of the 19th ACM SIGKDD international conference on Knowledge discovery and data mining , pages 329–337 . ACM , 2013 .
[ 29 ] F . Yates . Sir ronald fisher and the design of experiments . Biometrics , 20(2):307–321 , 1964 .
